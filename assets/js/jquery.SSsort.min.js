/*!
jQuery plug-in SSsort table-sorter/pager V.0.5.1
(C) 2014-2019 Tom Phane
License: GNU Affero GPL V.3 or later
*/
!function($){$.fn.SSsort=function(a){var l={table:null,header:null,body:null,rows:null,sortcol:null,sortdata:[],currentpage:1,pagecount:1,works:[]};return this.each(function(){var c=$.extend(l,$.fn.SSsort.defaults,a||{});c.table=this;var i=$(this);c.header=i.children("thead"),c.body=i.children("tbody"),c.rows=c.body[0].rows,c.works=[];var u=c.header.find("tr:first > th"),d=$.fn.jquery,f=$.fn.metadata,m=0;if(u.each(function(){var t=$(this),r=t.hasClass("nosort");if(!r&&f&&!1===t.metadata().sss&&(r=!0),!r){var a=function(t,r){var a=!1;if($.fn.metadata){var n=$(t).metadata().sss;if(!1===n)return!1;n&&(a=function(t){for(var r=e,a=s.length,n=t.toLowerCase(),o=r;o<a;o++)if(s[o].id.toLowerCase()===n)return s[o];for(o=0;o<r;o++)if(s[o].id.toLowerCase()===n)return s[o];return!1}(n))}if(!a){var l=t.cellIndex;a=function(t,r){var a,n,l=!1,c=r.rows,i=0;for(;!1===l&&(a=c[i]);)n=a.cells[t],""===(l=$.trim(o(n)))&&(l=!1),i++;if(!1!==l){for(var u=e,d=s.length,f=u;f<d;f++)if(s[f].is(l,n,r))return s[f];for(f=1;f<u;f++)if(s[f].is(l,n,r))return s[f]}return s[0]}(l,r)}return a}(this,c);a&&(c.works[m]={parser:a,dirty:!0,_map:[]},c.rows.length>1&&c.sortClass&&t.addClass(c.sortClass),d>="1.7"?t.on("click",n):t.bind("click",n))}m++}),$.data(this,"SSsortcfg",c),null!==c.firstsort){var h=u.eq(c.firstsort-1),g=h.hasClass("nosort");!g&&f&&!1===h.metadata().sss&&(g=!0),g?c.firstsort=null:h.trigger("click")}null===c.firstsort&&c.paginate&&(t(c),r(0,c),c.countid&&$("#"+c.countid).html(c.pagecount))}),this},$.fn.SSsort.defaults={sortClass:null,ascClass:null,descClass:null,evenClass:null,oddClass:null,evensortClass:null,oddsortClass:null,firstsort:null,sortdesc:!1,paginate:!1,pagesize:20,currentid:null,countid:null,onSorted:null};var s=[{id:"text",is:function(s){return!0},format:function(s){return $.trim(s)},type:"text"},{id:"number",is:function(s){return!isNaN(parseFloat(s))&&isFinite(s)},format:function(s){if(s){var e=Number(s);return isNaN(e)?Number.NEGATIVE_INFINITY:e}return(s+"").length>0?0:Number.POSITIVE_INFINITY},type:"numeric"},{id:"isoDate",is:function(s){return/^[12]\d{3}[\/-][01]\d[\/-]\[0-3]\d$/.test(s)},format:function(s){return Date.parse(s.replace(/-/g,"/"))},type:"numeric"}],e=s.length;function t(s){s.pagecount=1+(s.rows.length/s.pagesize|0)}function r(s,e){var t=parseInt(e.pagesize,10);e.currentid&&(e.currentpage=t<1?1:1+(s/t|0),$("#"+e.currentid).html(e.currentpage));var r=e.rows;t<1&&(t=r.length+1);for(var a=s+t,n=0;n<r.length;n++)r[n].style.display=n>=s&&n<a?"":"none"}function a(s){for(var e,t,r=s.works[s.sortcol],a=r.parser.format,n=s.rows,l=n.length,c=s.sortcol,i=[],u=0;u<l;u++)e=n[u].cells[c],i[u]=[a(o(e),e,s),u];t="text"===r.parser.type?s.sortdesc?function(s,e){return e[0].localeCompare(s[0])}:function(s,e){return s[0].localeCompare(e[0])}:s.sortdesc?function(s,e){return e[0]-s[0]}:function(s,e){return s[0]-e[0]},r._map=i.sort(t)}function n(s){var e=$(this).closest("table"),n=$.data(e[0],"SSsortcfg");if(!(n.rows.length<2)){var o=this.cellIndex,l=n.header.find("tr:first > th"),c=0;if(o>0)for(var i=0;i<o;i++){var u=l[i];if(u.hasAttribute("colspan")){var d=u.getAttribute("colspan");c+=parseInt(d,10)||1}else c++}var f,m,h=null;c===n.sortcol?(f=n.sortdesc?n.descClass:n.ascClass,n.sortdesc=!n.sortdesc,m=n.sortdesc?n.descClass:n.ascClass,f&&l.eq(c).removeClass(f),m&&l.eq(c).addClass(m),$(n.table).trigger("beforetablesort",{column:c,direction:n.sortdesc}),n.works[c].dirty?a(n):n.works[c]._map.reverse()):(null!==n.sortcol?(h=n.sortcol,(f=n.sortdesc?n.descClass:n.ascClass)&&l.eq(h).removeClass(f),n.sortClass&&(l.eq(c).removeClass(n.sortClass),l.eq(h).addClass(n.sortClass)),n.ascClass&&l.eq(c).addClass(n.ascClass),n.sortdesc=!1):(n.sortClass&&l.eq(c).removeClass(n.sortClass),(m=n.sortdesc?n.descClass:n.ascClass)&&l.eq(c).addClass(m)),n.sortcol=c,$(n.table).trigger("beforetablesort",{column:c,direction:n.sortdesc}),a(n)),setTimeout(function(){var s,e,a,o,l=!!n.oddClass&&new RegExp("(^|\\s+)"+n.oddClass+"(?!\\S)"),i=!!n.evenClass&&new RegExp("(^|\\s+)"+n.evenClass+"(?!\\S)"),d=!!n.oddClass&&new RegExp("(^|\\s+)"+n.oddsortClass+"(?!\\S)"),f=!!n.evenClass&&new RegExp("(^|\\s+)"+n.evensortClass+"(?!\\S)"),m=n.body[0],g=m.parentNode,p=m.nextSibling,v=n.rows,C=v.length,N=n.works[c]._map;g.removeChild(m);for(var b=0;b<C;b++)for(s=v[a=N[b][1]],u=s.cells[c],m.appendChild(s),b%2?(l&&(s.className=s.className.replace(l,"")),i&&!s.className.match(i)&&(s.className=s.className+" "+n.evenClass),d&&(u.className=u.className.replace(d,"")),f&&!u.className.match(f)&&(u.className=u.className+" "+n.evensortClass)):(i&&(s.className=s.className.replace(i,"")),l&&!s.className.match(l)&&(s.className=s.className+" "+n.oddClass),f&&(u.className=u.className.replace(f,"")),d&&!u.className.match(d)&&(u.className=u.className+" "+n.oddsortClass)),null!==h&&(e=s.cells[h],d&&(e.className=e.className.replace(d,"")),f&&(e.className=e.className.replace(f,""))),N[b][1]=b,o=b+1;o<C;o++)N[o][1]>a&&N[o][1]--;g.insertBefore(m,p),n.body=$(n.table).children("tbody"),n.rows=m.rows,n.works[c].dirty=void 0!==n.works[c].parser.watch&&n.works[c].parser.watch,n.paginate&&(n.currentpage=1,t(n),r(0,n),n.countid&&$("#"+n.countid).html(n.pagecount)),$(n.table).trigger("aftertablesort",{column:c,direction:n.sortdesc}),$.isFunction(n.onSorted)&&n.onSorted.call(n.table)},20)}}function o(s){for(;s.hasChildNodes();)s=s.firstChild;var e=s.nodeValue;return"#text"===s.nodeName&&""===$.trim(e)&&null!==(s=s.nextElementSibling)&&(e=s.nodeValue),e||!1}$.fn.SSsort.movePage=function(s,e,t){var a=$.data(s,"SSsortcfg");if(a){var n=e?t?a.pagecount:a.currentpage+1:t?1:a.currentpage-1;n>0&&n<=a.pagecount&&(a.currentpage=n,r((n-1)*a.pagesize,a))}},$.fn.SSsort.setCurrent=function(s,e,a){var n=$.data(s,"SSsortcfg");if(n){n[e]=a,n.countid&&t(n);var o=0;"currentpage"===e&&a>0&&(o=a-1),r(o,n),n.countid&&$("#"+n.countid).html(n.pagecount)}},$.fn.SSsort.mapTable=function(s){var e={},t=1;return $(s).find("tr").each(function(){var s=this.getAttribute("id")||this.getAttribute("name")||"row"+t,r={},a=1;$(this).each(function(){var s=[];$(this).children().each(function(){s[s.length]=this.hasAttribute("value")?this.getAttribute("value"):$(this).text()});var e=this.getAttribute("id")||this.getAttribute("name")||"col"+a;switch(s.length){case 0:r[e]="<empty>";break;case 1:r[e]=s[0];break;default:for(var t={},n=0;n<s.length;++n)t[n]=s[n];r[e]=t}a++}),e[s]=r,t++}),e},$.fn.SSsort.addParser=function(e,t){for(var r=s.length,a=e.id.toLowerCase(),n=0;n<r;n++)if(s[n].id.toLowerCase()===a)return void(t&&(s[n]=e));s[r]=e},$.fn.SSsort.formatFloat=function(s){var e=parseFloat(s);return isNaN(e)?Number.NEGATIVE_INFINITY:e},$.fn.SSsort.formatInt=function(s){var e=parseInt(s,10);return isNaN(e)?Number.NEGATIVE_INFINITY:e}}(jQuery);
