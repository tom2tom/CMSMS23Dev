/*!
jQuery plug-in SSsort table-sorter/pager V.0.5
(C) 2014-2018 Tom Phane
License: GNU Affero GPL V.3 or later
*/
;(function($){$.fn.SSsort=function(k){var l={table:null,header:null,body:null,rows:null,sortcol:null,sortdata:[],currentpage:1,pagecount:1,works:[]};this.each(function(){var n=$.extend(l,$.fn.SSsort.defaults,k||{});n.table=this;var t=$(this);n.header=t.children("thead");n.body=t.children("tbody");n.rows=n.body[0].rows;n.works=[];var m=n.header.find("tr:first > th");var p=$.fn.jquery;var s=$.fn.metadata;var o=0;m.each(function(){var v=$(this);var u=v.hasClass("nosort");if(!u&&s){if(v.metadata().sss===false){u=true}}if(!u){var w=f(this,n);if(w){n.works[o]={parser:w,dirty:true,_map:[]};if(n.rows.length>1&&n.sortClass){v.addClass(n.sortClass)}if(p>="1.7"){v.on("click",i)}else{v.bind("click",i)}}}o++});$.data(this,"SSsortcfg",n);if(n.firstsort!==null){var r=m.eq(n.firstsort-1);var q=r.hasClass("nosort");if(!q&&s){if(r.metadata().sss===false){q=true}}if(q){n.firstsort=null}else{r.trigger("click")}}if(n.firstsort===null&&n.paginate){b(n);d(0,n);if(n.countid){$("#"+n.countid).html(n.pagecount)}}});return this};$.fn.SSsort.defaults={sortClass:null,ascClass:null,descClass:null,evenClass:null,oddClass:null,evensortClass:null,oddsortClass:null,firstsort:null,sortdesc:false,paginate:false,pagesize:20,currentid:null,countid:null,onSorted:null};var j=[{id:"text",is:function(k){return true},format:function(k){return $.trim(k)},type:"text"},{id:"number",is:function(k){return(!isNaN(parseFloat(k))&&isFinite(k))},format:function(k){if(k){var l=Number(k);return(isNaN(l))?Number.NEGATIVE_INFINITY:l}else{if((k+"").length>0){return 0}else{return Number.POSITIVE_INFINITY}}},type:"numeric"},{id:"isoDate",is:function(k){return/^[12]\d{3}[\/-][01]\d[\/-]\[0-3]\d$/.test(k)},format:function(k){return Date.parse(k.replace(/-/g,"/"))},type:"numeric"}],g=j.length;$.fn.SSsort.movePage=function(m,o,l){var k=$.data(m,"SSsortcfg");if(k){var n=(o)?((l)?k.pagecount:k.currentpage+1):((l)?1:k.currentpage-1);if(n>0&&n<=k.pagecount){k.currentpage=n;d((n-1)*k.pagesize,k)}}};$.fn.SSsort.setCurrent=function(m,n,l){var k=$.data(m,"SSsortcfg");if(k){k[n]=l;d(0,k);if(k.countid){b(k);$("#"+k.countid).html(k.pagecount)}}};$.fn.SSsort.mapTable=function(m){var k={};var l=1;$(m).find("tr").each(function(){var n=this.getAttribute("id")||this.getAttribute("name")||"row"+l;var p={};var o=1;$(this).each(function(){var r=[];$(this).children().each(function(){r[r.length]=(this.hasAttribute("value"))?this.getAttribute("value"):$(this).text()});var t=this.getAttribute("id")||this.getAttribute("name")||"col"+o;switch(r.length){case 0:p[t]="<empty>";break;case 1:p[t]=r[0];break;default:var s={};for(var q=0;q<r.length;++q){s[q]=r[q]}p[t]=s;break}o++});k[n]=p;l++});return k};$.fn.SSsort.addParser=function(p,o){var k=j.length,n=p.id.toLowerCase();for(var m=0;m<k;m++){if(j[m].id.toLowerCase()===n){if(o){j[m]=p}return}}j[k]=p};$.fn.SSsort.formatFloat=function(k){var l=parseFloat(k);return(isNaN(l))?Number.NEGATIVE_INFINITY:l};$.fn.SSsort.formatInt=function(k){var l=parseInt(k,10);return(isNaN(l))?Number.NEGATIVE_INFINITY:l};function b(k){k.pagecount=((k.rows.length/k.pagesize)|0)+1}function d(l,k){var p=parseInt(k.pagesize,10);if(k.currentid){if(p<1){k.currentpage=1}else{k.currentpage=((l/p)|0)+1}$("#"+k.currentid).html(k.currentpage)}var o=k.rows;if(p<1){p=o.length+1}var n=l+p;for(var m=0;m<o.length;m++){o[m].style.display=(m>=l&&m<n)?"":"none"}}function e(s){var n=s.works[s.sortcol];var k=n.parser.format;var u=s.rows;var q=u.length;var t=s.sortcol;var p=[];var o;for(var r=0;r<q;r++){o=u[r].cells[t];p[r]=[k(a(o),o,s),r]}var m;if(n.parser.type==="text"){m=(s.sortdesc)?function(v,l){return(l[0].localeCompare(v[0]))}:function(v,l){return(v[0].localeCompare(l[0]))}}else{m=(s.sortdesc)?function(v,l){return(l[0]-v[0])}:function(v,l){return(v[0]-l[0])}}n._map=p.sort(m)}function i(r){var k=$(this).closest("table");var p=$.data(k[0],"SSsortcfg");if(p.rows.length<2){return}var n=this.cellIndex;var w=p.header.find("tr:first > th");var m=0;if(n>0){for(var o=0;o<n;o++){var v=w[o];if(v.hasAttribute("colspan")){var u=v.getAttribute("colspan");m+=parseInt(u,10)||1}else{m++}}}var s=null,q,t;if(m===p.sortcol){q=(p.sortdesc)?p.descClass:p.ascClass;p.sortdesc=!p.sortdesc;t=(p.sortdesc)?p.descClass:p.ascClass;if(q){w.eq(m).removeClass(q)}if(t){w.eq(m).addClass(t)}$(p.table).trigger("beforetablesort",{column:m,direction:p.sortdesc});if(p.works[m].dirty){e(p)}else{p.works[m]._map.reverse()}}else{if(p.sortcol!==null){s=p.sortcol;q=(p.sortdesc)?p.descClass:p.ascClass;if(q){w.eq(s).removeClass(q)}if(p.sortClass){w.eq(m).removeClass(p.sortClass);w.eq(s).addClass(p.sortClass)}if(p.ascClass){w.eq(m).addClass(p.ascClass)}p.sortdesc=false}else{if(p.sortClass){w.eq(m).removeClass(p.sortClass)}t=(p.sortdesc)?p.descClass:p.ascClass;if(t){w.eq(m).addClass(t)}}p.sortcol=m;$(p.table).trigger("beforetablesort",{column:m,direction:p.sortdesc});e(p)}setTimeout(function(){var D=(p.oddClass)?new RegExp("(^|\\s+)"+p.oddClass+"(?!\\S)"):false;var H=(p.evenClass)?new RegExp("(^|\\s+)"+p.evenClass+"(?!\\S)"):false;var G=(p.oddClass)?new RegExp("(^|\\s+)"+p.oddsortClass+"(?!\\S)"):false;var x=(p.evenClass)?new RegExp("(^|\\s+)"+p.evensortClass+"(?!\\S)"):false;var E=p.body[0];var I=E.parentNode;var L=E.nextSibling;var K=p.rows;var z=K.length;var y=p.works[m]._map;var J,F,B,A;I.removeChild(E);for(var C=0;C<z;C++){B=y[C][1];J=K[B];v=J.cells[m];E.appendChild(J);if(C%2){if(D){J.className=J.className.replace(D,"")}if(H&&!J.className.match(H)){J.className=J.className+" "+p.evenClass}if(G){v.className=v.className.replace(G,"")}if(x&&!v.className.match(x)){v.className=v.className+" "+p.evensortClass}}else{if(H){J.className=J.className.replace(H,"")}if(D&&!J.className.match(D)){J.className=J.className+" "+p.oddClass}if(x){v.className=v.className.replace(x,"")}if(G&&!v.className.match(G)){v.className=v.className+" "+p.oddsortClass}}if(s!==null){F=J.cells[s];if(G){F.className=F.className.replace(G,"")}if(x){F.className=F.className.replace(x,"")}}y[C][1]=C;for(A=C+1;A<z;A++){if(y[A][1]>B){y[A][1]--}}}I.insertBefore(E,L);p.body=$(p.table).children("tbody");p.rows=E.rows;p.works[m].dirty=(typeof(p.works[m].parser.watch)!=="undefined"&&p.works[m].parser.watch);if(p.paginate){p.currentpage=1;b(p);d(0,p);if(p.countid){$("#"+p.countid).html(p.pagecount)}}$(p.table).trigger("aftertablesort",{column:m,direction:p.sortdesc});if($.isFunction(p.onSorted)){p.onSorted.call(p.table)}},20)}function a(l){while(l.hasChildNodes()){l=l.firstChild}var k=l.nodeValue;return(k)?k:false}function c(s,o){var r=false,k,u=o.rows,q=0,t;while(r===false){t=u[q];if(t){k=t.cells[s];r=$.trim(a(k))}else{break}q++}if(r!==false){var p=$.fn.SSsort.ipcount,m=j.length;for(var n=p;n<m;n++){if(j[n].is(r,k,o)){return j[n]}}for(n=1;n<p;n++){if(j[n].is(r,k,o)){return j[n]}}}return j[0]}function h(n){var p=g,k=j.length,m=n.toLowerCase();for(var o=p;o<k;o++){if(j[o].id.toLowerCase()===m){return j[o]}}for(o=0;o<p;o++){if(j[o].id.toLowerCase()===m){return j[o]}}return false}function f(n,k){var o=false;if($.fn.metadata){var m=$(n).metadata().sss;if(m===false){return false}else{if(m){o=h(m)}}}if(!o){var l=n.cellIndex;o=c(l,k)}return o}})(jQuery);