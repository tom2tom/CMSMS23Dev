/*!
javascript for CMSMS Ebonne-theme v.0.8
(C) 2019 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License: Affero GPL 3+
*/
var ggjs={cookie_handler:"themes/assets/js/js-cookie.min.js",small_width:600,$container:null,$menucontainer:null,$menu:null,init:function(){this.$container=$("#ggp_container"),this.$menucontainer=this.$container.find("#ggp_navwrap"),this.$menu=this.$menucontainer.find("#ggp_nav"),this.handleSidebar(),$(window).resize(function(){ggjs.updateDisplay()}),this.handleSubMenu(this.$menu),this.$menu.find(".open-nav").on("click",function(e){e.preventDefault();var t=$(this),n=t.next(),a=[];if(n.is(":visible"))t.removeClass("open-sub");else{var i=ggjs.$menu.find(".open-sub");if(i.length){i.removeClass("open-sub");var o=i.next();a.push(o.slideUp(50),function(){o.find("li,ul").hide()})}t.addClass("open-sub")}return n.find("li,ul").show(),a.push(n.slideToggle(50)),$.when.apply($,a).done(function(){ggjs.updateDisplay()}),!1}),this.showNotifications(),this.migrateUIElements(),this.updateDisplay(),this.setupAlerts(),cms_data.alertfunc=this.popup_alert,cms_data.confirmfunc=this.popup_confirm,cms_data.promptfunc=this.popup_prompt,cms_data.dialogfunc=this.popup_dialog,$('a[rel="external"]').attr("target","_blank"),$("input.defaultfocus:eq(0), input[autofocus]").focus(),this.isLocalStorage()||this.loadScript(this.cookie_handler)},loadScript:function(e,t,n){var a=!0,i=null;return $.isFunction(t)?(i=t,a=n||a):(a=t||a,i=n||i),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax(e,{dataType:"script",async:!1,cache:a}).done(i)},setStorageValue:function(e,t,n){try{if(this.isLocalStorage()){var a;if(localStorage.removeItem(e),null!==n)a={value:t,timestamp:(new Date).getTime()+24*n*60*60*1e3};else a={value:t,timestamp:""};localStorage.setItem(e,JSON.stringify(a))}else{if(!this.isCookieScript())throw"No cookie storage!";null!==n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t)}}catch(n){console.log("localStorage Error: set("+e+", "+t+")"),console.log(n)}},getStorageValue:function(e){var t;if(this.isLocalStorage()){var n=JSON.parse(localStorage.getItem(e));null!==n&&n.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==n&&(t=n.value)}else t=this.isCookieScript()?Cookies(e):"";return t},removeStorageValue:function(e){this.isLocalStorage()?localStorage.removeItem(e):this.isCookieScript()&&Cookies.remove(e)},isLocalStorage:function(){return"undefined"!=typeof Storage},isCookieScript:function(){return"undefined"!=typeof Cookies},isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in window||navigator.msMaxTouchPoints>0||window.DocumentTouch&&document instanceof DocumentTouch))return!0},handleSidebar:function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;"sidebar-off"===this.getStorageValue("sidebar-pref")||e<=this.small_width?(this.$menucontainer.addClass("sidebar-off").removeClass("sidebar-on"),this.$menu.addClass("sidebar-off").removeClass("sidebar-on")):(this.$menucontainer.addClass("sidebar-on").removeClass("sidebar-off"),this.$menu.addClass("sidebar-on").removeClass("sidebar-off"))},clickSidebar:function(){this.$menucontainer.hasClass("sidebar-on")?this.closeSidebar():this.openSidebar()},openSidebar:function(){this.$menucontainer.addClass("sidebar-on").removeClass("sidebar-off"),this.$menu.find("li.current ul").show(),this.setStorageValue("sidebar-pref","sidebar-on",60)},closeSidebar:function(){this.$menucontainer.removeClass("sidebar-on").addClass("sidebar-off"),this.$menu.find("li ul").hide(),this.setStorageValue("sidebar-pref","sidebar-off",60)},handleSubMenu:function(e){e.find("li.current span").addClass("open-sub")},showNotifications:function(){cms_notify_all(),$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning" title="'+cms_lang("gotit")+'"></span>'),$(".close-warning").on("click",function(){$(this).parent().hide().remove()});var e=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){this.setStorageValue(e,"hidden",60)}),"hidden"===this.getStorageValue(e)&&$(".pagewarning").addClass("hidden"),$(document).on("cms_ajax_apply",function(e){var t="Success"===e.response?"success":"error";cms_notify(t,e.details)})},migrateUIElements:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var e,t,n,a=$(this);a.hasClass("noautobtn")||a.hasClass("no-ui-btn")||!a.val().trim()||(e=a.is("[name*=submit]")?"iconcheck":a.is("[name*=apply]")?"iconapply":a.is("[name*=cancel]")||a.is("[name*=close]")?"iconclose":a.is("[name*=reset]")||"refresh"===a.attr("id")?"iconundo":"",t=a.is("input")?a.val():a.text(),n=$('<button type="submit" class="adminsubmit '+e+'">'+t+"</button>"),$(this.attributes).each(function(t,a){switch(a.name){case"type":break;case"class":var i=a.value.replace(/(^|\s*)ui-\S+/g,"");""!==i&&n.attr("class","adminsubmit "+e+" "+i);break;default:n.attr(a.name,a.value)}}),a.replaceWith(n))}),$("a.pageback").addClass("link_button icon back")},updateDisplay:function(){this.handleSidebar()},handleAlert:function(e){var t=$(e).closest(".alert-box"),n=t.data("alert-name");if(n)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:n}}).fail(function(e,t,n){console.debug("problem deleting an alert: "+n)}).done(function(){t.slideUp(1e3),t.parent().children().length<=1&&(cms_dialog(t.closest("div.ui-dialog-content"),"close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),t.remove()})},setupAlerts:function(){$("a#alerts").on("click",function(e){return e.preventDefault(),cms_dialog($("#alert-dialog")),!1}),$(".alert-msg a").on("click",function(e){return e.preventDefault(),ggjs.handleAlert(e.target),!1}),$(".alert-remove").on("click",function(e){return e.preventDefault(),ggjs.handleAlert(e.target),!1})},popup_alert:function(e,t){return $.alertable.alert(e,{okButton:'<button type="button" class="adminsubmit">'+cms_lang("close")+"</button>"})},popup_confirm:function(e,t,n,a){return $.alertable.confirm(e,{okButton:'<button type="button" class="adminsubmit icon check">'+n+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+a+"</button>"})},popup_prompt:function(e,t,n){return $.alertable.prompt(e,{prompt:'<input type="text" class="alertable-input" value="'+t+'" />',okButton:'<button type="button" class="adminsubmit icon check">'+cms_lang("ok")+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+cms_lang("cancel")+"</button>"})},popup_dialog:function(e,t){return(t=t||{}).classes=$.extend(t.classes||{},{"ui-dialog":"alertable","ui-dialog-title":"alertable-message","ui-dialog-buttonpane":"alertable-buttons","ui-dialog-buttonset":"alertable-buttons"}),e.dialog(t)}};$(function(){ggjs.init()});
