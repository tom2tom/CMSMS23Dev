/*!
javascript for CMSMS Ghostgum-theme v.0.9
(C) 2019-2020 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License: Affero GPL 3+
*/
var themejs={};(function($,t,e,i){var a="themes/assets/js/js-cookie.min.js",n=600,s=null,o=null,r=null;this.init=function(){s=$("#ggp_container"),o=s.find("#ggp_navwrap"),r=o.find("#ggp_nav");var e=s.find("#page_tabs");e.length>0&&this.stickIt(e),this.handleSidebar();var n=this;o.find("#ggp_headlink").prop("href","javascript:"+i+".clickSidebar()"),o.find("#ggp_headzone").on("click",function(t){t.preventDefault(),n.clickSidebar()}),$(t).on("resize",function(){n.updateDisplay()}),this.handleSubMenu(r),r.find(".open-nav").on("click",function(t){t.preventDefault();var e=$(this),i=e.next(),a=[];if(0===i.length||"hidden"===i.css("visibility")||"none"===i.css("display")){var s=r.find(".open-sub");if(s.length){s.removeClass("open-sub");var o=s.next();a.push(o.slideUp(50),function(){o.find("li,ul").hide()})}e.addClass("open-sub")}else e.removeClass("open-sub");return i.find("li,ul").show(),a.push(i.slideToggle(50)),$.when.apply($,a).done(function(){n.updateDisplay()}),!1}),this.showNotifications(),this.migrateUIElements(),this.updateDisplay(),this.setupAlerts(),cms_data.alertfunc=this.popup_alert,cms_data.confirmfunc=this.popup_confirm,cms_data.promptfunc=this.popup_prompt,cms_data.dialogfunc=this.popup_dialog,$('a[rel="external"]').attr("target","_blank"),$("input.defaultfocus, input[autofocus]").eq(0).focus(),this.isLocalStorage()||this.loadScript(a)},this.loadScript=function(t,e,i){var a=!0,n=null;return"function"==typeof e?(n=e,a=i||a):(a=e||a,n=i||n),$('script[type="text/javascript"]').each(function(){return t!==$(this).attr("src")}),$.ajax(t,{dataType:"script",async:!1,cache:a}).done(n)},this.setParms=function(t){void 0!==t.cookiescript&&(a=t.cookiescript,this.isLocalStorage()||this.loadScript(a)),void 0!==t.viewwidth&&(n=parseInt(t.viewwidth,10)||600)},this.setStorageValue=function(t,e,i){try{if(this.isLocalStorage()){var a;if(localStorage.removeItem(t),null!==i)a={value:e,timestamp:(new Date).getTime()+24*i*60*60*1e3};else a={value:e,timestamp:""};localStorage.setItem(t,JSON.stringify(a))}else{if(!this.isCookieScript())throw"No cookie storage!";null!==i?Cookies.set(t,e,{expires:i}):Cookies.set(t,e)}}catch(i){console.log("localStorage Error: set("+t+", "+e+")"),console.log(i)}},this.getStorageValue=function(t){var e;if(this.isLocalStorage()){var i=JSON.parse(localStorage.getItem(t));null!==i&&i.timestamp<(new Date).getTime()?this.removeStorageValue(t):null!==i&&(e=i.value)}else e=this.isCookieScript()?Cookies(t):"";return e},this.removeStorageValue=function(t){this.isLocalStorage()?localStorage.removeItem(t):this.isCookieScript()&&Cookies.remove(t)},this.isLocalStorage=function(){return"undefined"!=typeof Storage},this.isCookieScript=function(){return"undefined"!=typeof Cookies},this._isMobileDevice=function(){if("ontouchstart"in t||"ontouchstart"in e.documentElement||t.DocumentTouch&&e instanceof DocumentTouch||navigator.msMaxTouchPoints>0)return!0;if(t.matchMedia){var i=["("," -webkit- -moz- -o- -ms- ".split(" ").join("touch-enabled),("),"Z",")"].join("").replace(",(Z)","");return t.matchMedia(i).matches}return!1},this.stickIt=function(t){var e=t.outerHeight(!0),i=t.css("zIndex"),a="auto"===i?500:i+10;t.after($("<div/>",{style:"height:"+e+"px;"})),t.css({position:"fixed",width:"100%","z-index":a})},this.handleSidebar=function(){var i=t.innerWidth||e.documentElement.clientWidth||e.body.clientWidth;"sidebar-off"===this.getStorageValue("sidebar-pref")||i<=n?(o.addClass("sidebar-off").removeClass("sidebar-on"),r.addClass("sidebar-off").removeClass("sidebar-on")):(o.addClass("sidebar-on").removeClass("sidebar-off"),r.addClass("sidebar-on").removeClass("sidebar-off"))},this.clickSidebar=function(){o.hasClass("sidebar-on")?this.closeSidebar():this.openSidebar()},this.openSidebar=function(){o.addClass("sidebar-on").removeClass("sidebar-off"),r.find("li.current ul").show(),this.setStorageValue("sidebar-pref","sidebar-on",60)},this.closeSidebar=function(){o.removeClass("sidebar-on").addClass("sidebar-off"),r.find("li ul").hide(),this.setStorageValue("sidebar-pref","sidebar-off",60)},this.handleSubMenu=function(t){t.find("li.current span").addClass("open-sub")},this.showNotifications=function(){cms_notify_all(),$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning" title="'+cms_lang("gotit")+'"></span>'),$(".close-warning").on("click",function(){$(this).parent().hide().remove()});var t=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){this.setStorageValue(t,"hidden",60)}),"hidden"===this.getStorageValue(t)&&$(".pagewarning").addClass("hidden"),$(e).on("cms_ajax_apply",function(t){var e="Success"===t.response?"success":"error";cms_notify(e,t.details)})},this.migrateUIElements=function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var t,e,i,a=$(this);a.hasClass("noautobtn")||a.hasClass("no-ui-btn")||!a.val().trim()||(t=a.is("[name*=submit]")?"iconcheck":a.is("[name*=apply]")?"iconapply":a.is("[name*=cancel]")||a.is("[name*=close]")?"iconclose":a.is("[name*=reset]")||"refresh"===a.attr("id")?"iconundo":"",e=a.is("input")?a.val():a.text(),i=$('<button type="submit" class="adminsubmit '+t+'">'+e+"</button>"),$(this.attributes).each(function(e,a){switch(a.name){case"type":break;case"class":var n=a.value.replace(/(^|\s*)ui-\S+/g,"");""!==n&&i.attr("class","adminsubmit "+t+" "+n);break;default:i.attr(a.name,a.value)}}),a.replaceWith(i))}),$("a.pageback").addClass("link_button icon back")},this.updateDisplay=function(){this.handleSidebar()},this.handleAlert=function(t){var e=$(t).closest(".alert-box"),i=e.data("alert-name");if(i)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:i}}).fail(function(t,e,i){console.debug("problem deleting an alert: "+i)}).done(function(){e.slideUp(1e3),e.parent().children().length<=1&&(cms_dialog(e.closest("div.ui-dialog-content"),"close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),e.remove()})},this.setupAlerts=function(){$("a#alerts").on("click",function(t){return t.preventDefault(),cms_dialog($("#alert-dialog")),!1});var t=this;$(".alert-msg a").on("click",function(e){return e.preventDefault(),t.handleAlert(e.target),!1}),$(".alert-remove").on("click",function(e){return e.preventDefault(),t.handleAlert(e.target),!1})},this.popup_alert=function(t,e){return $.alertable.alert(t,{okButton:'<button type="button" class="adminsubmit">'+cms_lang("close")+"</button>"})},this.popup_confirm=function(t,e,i,a){return $.alertable.confirm(t,{okButton:'<button type="button" class="adminsubmit icon check">'+i+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+a+"</button>"})},this.popup_prompt=function(t,e,i){return $.alertable.prompt(t,{prompt:'<input type="text" class="alertable-input" value="'+e+'" />',okButton:'<button type="button" class="adminsubmit icon check">'+cms_lang("ok")+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+cms_lang("cancel")+"</button>"})},this.popup_dialog=function(t,e){return(e=e||{}).classes=$.extend(e.classes||{},{"ui-dialog":"alertable","ui-dialog-title":"alertable-message","ui-dialog-buttonpane":"alertable-buttons","ui-dialog-buttonset":"alertable-buttons"}),t.dialog(e)}}).call(themejs,jQuery,window,document,"themejs"),$(function(){themejs.init()});