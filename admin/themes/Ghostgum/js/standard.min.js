/*!
javascript for Ghostgum-theme
(C) CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License: GPL2+
*/
;var ggjs={cookie_handler:"themes/assets/js/js-cookie.min.js",small_width:992,$container:null,$menucontainer:null,$menu:null,init:function(){this.$container=$("#ggp_container");this.$menucontainer=this.$container.find("#ggp_navwrap");this.$menu=this.$menucontainer.find("#ggp_nav");this.handleSidebar();$(window).resize(function(){ggjs.updateDisplay()});this.handleSubMenu(this.$menu);this.$menu.find(".open-nav").on("click",function(f){f.preventDefault();var c=$(this),d=c.next(),a=[];if(!d.is(":visible")){var g=ggjs.$menu.find(".open-sub");if(g.length){g.removeClass("open-sub");var b=g.next();a.push(b.slideUp(50),function(){b.find("li,ul").hide()})}c.addClass("open-sub")}else{c.removeClass("open-sub")}d.find("li,ul").show();a.push(d.slideToggle(50));$.when.apply($,a).done(function(){ggjs.updateDisplay()});return false});this.showNotifications();this.migrateUIElements();this.updateDisplay();this.setupAlerts();cms_data.alertfunc=this.popup_alert;cms_data.confirmfunc=this.popup_confirm;cms_data.promptfunc=this.popup_prompt;cms_data.dialogfunc=this.popup_dialog;$("a[rel=external]").attr("target","_blank");$("input.defaultfocus:eq(0), input[autofocus]").focus();if(!this.isLocalStorage()){this.loadScript(this.cookie_handler)}},loadScript:function(d,c,b){var a=true,f=null,e=true;if($.isFunction(c)){f=c;a=b||a}else{a=c||a;f=b||f}$('script[type="text/javascript"]').each(function(){var g=(d!==$(this).attr("src"));return g});if(e){$.ajax({type:"GET",url:d,async:false,success:f,dataType:"script",cache:a})}else{if($.isFunction(f)){f.call(this)}}},setStorageValue:function(d,e,a){try{if(this.isLocalStorage()){localStorage.removeItem(d);var f;if(a!==null){var b=new Date().getTime()+(a*24*60*60*1000);f={value:e,timestamp:b}}else{f={value:e,timestamp:""}}localStorage.setItem(d,JSON.stringify(f))}else{if(this.isCookieScript()){if(a!==null){Cookies.set(d,e,{expires:a})}else{Cookies.set(d,e)}}else{throw"No cookie storage!"}}}catch(c){console.log("localStorage Error: set("+d+", "+e+")");console.log(c)}},getStorageValue:function(a){var c;if(this.isLocalStorage()){var b=JSON.parse(localStorage.getItem(a));if(b!==null&&b.timestamp<new Date().getTime()){this.removeStorageValue(a)}else{if(b!==null){c=b.value}}}else{if(this.isCookieScript()){c=Cookies(a)}else{c=""}}return c},removeStorageValue:function(a){if(this.isLocalStorage()){localStorage.removeItem(a)}else{if(this.isCookieScript()){Cookies.remove(a)}}},isLocalStorage:function(){return typeof Storage!=="undefined"},isCookieScript:function(){return typeof Cookies!=="undefined"},isMobileDevice:function(){var b=navigator.userAgent.toLowerCase(),a=/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i;if(b.match(a)&&(("ontouchstart" in window)||(navigator.msMaxTouchPoints>0)||window.DocumentTouch&&document instanceof DocumentTouch)){return true}},handleSidebar:function(){var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(this.getStorageValue("sidebar-pref")==="sidebar-off"||a<=this.small_width){this.$menucontainer.addClass("sidebar-off").removeClass("sidebar-on");this.$menu.addClass("sidebar-off").removeClass("sidebar-on")}else{this.$menucontainer.addClass("sidebar-on").removeClass("sidebar-off");this.$menu.addClass("sidebar-on").removeClass("sidebar-off")}},clickSidebar:function(){if(this.$menucontainer.hasClass("sidebar-on")){this.closeSidebar()}else{this.openSidebar()}},openSidebar:function(){this.$menucontainer.addClass("sidebar-on").removeClass("sidebar-off");this.$menu.find("li.current ul").show();this.setStorageValue("sidebar-pref","sidebar-on",60)},closeSidebar:function(){this.$menucontainer.removeClass("sidebar-on").addClass("sidebar-off");this.$menu.find("li ul").hide();this.setStorageValue("sidebar-pref","sidebar-off",60)},handleSubMenu:function(a){a.find("li.current span").addClass("open-sub")},showNotifications:function(){cms_notify_all();$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning" title="'+cms_lang("gotit")+'"></span>');$(".close-warning").on("click",function(){var b=$(this).parent();b.hide().remove()});var a=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){this.setStorageValue(a,"hidden",60)});if(this.getStorageValue(a)==="hidden"){$(".pagewarning").addClass("hidden")}$(document).on("cms_ajax_apply",function(c){var b=(c.response==="Success")?"success":"error";cms_notify(b,c.details)})},migrateUIElements:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var b=$(this);if(!(b.hasClass("noautobtn")||b.hasClass("no-ui-btn"))){var d,a,c;if(b.is("[name*=submit]")){d="iconcheck"}else{if(b.is("[name*=apply]")){d="iconapply"}else{if(b.is("[name*=cancel]")||b.is("[name*=close]")){d="iconclose"}else{if(b.is("[name*=reset]")||b.attr("id")==="refresh"){d="iconundo"}else{d=""}}}}if(b.is("input")){a=b.val()}else{a=b.text()}c=$('<button type="submit" class="adminsubmit '+d+'">'+a+"</button>");$(this.attributes).each(function(e,g){switch(g.name){case"type":break;case"class":var f=g.value.replace(/(^|\s*)ui-\S+/g,"");if(f!==""){c.attr("class","adminsubmit "+d+" "+f)}break;default:c.attr(g.name,g.value);break}});b.replaceWith(c)}});$("a.pageback").addClass("link_button icon back")},updateDisplay:function(){this.handleSidebar()},handleAlert:function(a){var c=$(a).closest(".alert-box");var b=c.data("alert-name");if(!b){return}return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:b}}).done(function(){c.slideUp(1000);var d=c.parent();if(d.children().length<=1){cms_dialog(c.closest("div.ui-dialog-content"),"close");$("#alert-noalerts").show();$("a#alerts").closest("li").remove()}c.remove()}).fail(function(f,d,e){console.debug("problem deleting an alert: "+e)})},setupAlerts:function(){$("a#alerts").on("click",function(a){a.preventDefault();cms_dialog($("#alert-dialog"));return false});$(".alert-msg a").on("click",function(a){a.preventDefault();ggjs.handleAlert(a.target);return false});$(".alert-remove").on("click",function(a){a.preventDefault();ggjs.handleAlert(a.target);return false})},popup_alert:function(b,a){return $.alertable.alert(b,{okButton:'<button type="button" class="adminsubmit">'+cms_lang("close")+"</button>"})},popup_confirm:function(c,b,d,a){return $.alertable.confirm(c,{okButton:'<button type="button" class="adminsubmit icon check">'+d+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+a+"</button>"})},popup_prompt:function(c,b,a){return $.alertable.prompt(c,{prompt:'<input type="text" class="alertable-input" value="'+b+'" />',okButton:'<button type="button" class="adminsubmit icon check">'+cms_lang("ok")+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+cms_lang("cancel")+"</button>"})},popup_dialog:function(b,a){a=a||{};a.classes=$.extend(a.classes||{},{"ui-dialog":"alertable","ui-dialog-title":"alertable-message","ui-dialog-buttonpane":"alertable-buttons","ui-dialog-buttonset":"alertable-buttons"});b.dialog(a)}};$(function(){ggjs.init()});