!function(e,$){"use strict";var t=e.OE={};$(document).ready(function(){t.helper.init(),t.view.init()}),t.helper={init:function(){$("a[rel=external]").attr("target","_blank"),$("input.defaultfocus:eq(0), input[autofocus]").focus(),this._isLocalStorage()||this.loadScript("themes/OneEleven/includes/jquery.cookie.min.js")},loadScript:function(e,t,a){var n=!0,o=null;$.isFunction(t)?(o=t,n=a||n):(n=t||n,o=a||o),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax({type:"GET",url:e,async:!1,success:o,dataType:"script",cache:n})},setStorageValue:function(e,t,a){var n=(new Date).getTime()+24*a*60*60*1e3,o={};try{!0===this._isLocalStorage()?(localStorage.removeItem(e),o=null!==a?{value:t,timestamp:n}:{value:t,timestamp:""},localStorage.setItem(e,JSON.stringify(o))):(null!==a&&(o={expires:a}),"undefined"!==$.fn.cookie&&$.cookie(e,t,o))}catch(a){console.log("localStorage Error: set("+e+", "+t+")"),console.log(a)}},getStorageValue:function(e){var t,a="";return this._isLocalStorage()?null!==(a=JSON.parse(localStorage.getItem(e)))&&a.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==a&&(t=a.value):"undefined"!==$.fn.cookie&&(t=$.cookie(e)),t},removeStorageValue:function(e){this._isLocalStorage()?localStorage.removeItem(e):$.cookie(e,null)},equalHeight:function(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)}),e.height(t)},_isLocalStorage:function(){return"undefined"!=typeof Storage},_isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in window||navigator.msMaxTouchPoints>0||window.DocumentTouch&&document instanceof DocumentTouch))return!0}},t.view={init:function(){var e=this,t=$(".toggle-button"),a=$("#oe_container"),n=$("#oe_pagemenu");t.on("click",function(t){t.preventDefault(),a.hasClass("sidebar-on")?e._closeSidebar(a,n):e._showSidebar(a,n)}),e.toggleSubMenu(n,50),e.showNotifications(),e.setupAlerts(),e.updateDisplay(),e.handleSidebar(a),$(window).resize(function(){e.handleSidebar(a),e.updateDisplay()})},handleSidebar:function(e){var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;"sidebar-off"===t.helper.getStorageValue("sidebar-pref")||a<=992?e.addClass("sidebar-off").removeClass("sidebar-on"):e.addClass("sidebar-on").removeClass("sidebar-off")},toggleSubMenu:function(e,t){var a=this;e.find("li.current span").addClass("open-sub"),e.find("> li > span").click(function(){var n=$(this).next(),o=[];!1===n.is(":visible")&&o.push(e.find("ul").slideUp(t)),o.push(n.slideToggle(t)),$.when.apply($,o).done(function(){a.updateDisplay()})})},showNotifications:function(){$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning"></span>'),$(document).on("click",".close-warning",function(){$(this).parent().hide(),$(this).parent().remove()});var e=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").click(function(){t.helper.setStorageValue(e,"hidden",60)}),"hidden"===t.helper.getStorageValue(e)&&$(".pagewarning").addClass("hidden"),$(".message:not(.no-slide)").click(function(){$(".message").slideUp()}),$(".message:not(.no-slide), .pageerrorcontainer:not(.no-slide), .pagemcontainer:not(.no-slide)").each(function(){var e=$(this);$(e).hide().slideDown(1e3,function(){window.setTimeout(function(){e.slideUp()},1e4)})}),$(document).on("cms_ajax_apply",function(e){$("button[name=cancel], button[name=m1_cancel]").fadeOut(),$("button[name=cancel], button[name=m1_cancel]").button("option","label",e.close),$("button[name=cancel], button[name=m1_cancel]").fadeIn();var t="";"Success"===e.response?t='<aside class="message pagemcontainer" role="status"><span class="close-warning">Close</span><p class="pagemessage">'+e.details+"</p></aside>":(t='<aside class="message pageerrorcontainer" role="alert"><span class="close-warning">Close</span><ul class="pageerror">',t+=e.details,t+="</ul></aside>"),$("body").append(t).slideDown(1e3,function(){window.setTimeout(function(){$(".message").slideUp(),$(".message").remove()},1e4)}),$(document).on("click",".close-warning",function(){$(".message").slideUp(),$(".message").remove()})})},setUIButtons:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var e=$(this),t=e.data("uiIcon")||"ui-icon-circle-check",a=e.val(),n=$("<button />");e.hasClass("noautobtn")&&e.hasClass("no-ui-btn")||(e.is("[name*=apply]")?t=e.data("uiIcon")||"ui-icon-disk":e.is("[name*=cancel]")?t=e.data("uiIcon")||"ui-icon-circle-close":(e.is("[name*=resettodefault]")||"refresh"===e.attr("id"))&&(t=e.data("uiIcon")||"ui-icon-refresh")),e.is(":button")&&(a=e.text()),$(this.attributes).each(function(e,t){n.attr(t.name,t.value)}),n.button({icons:{primary:t},label:a}),e.replaceWith(n)}),$("a.pageback").addClass("ui-state-default ui-corner-all").prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},updateDisplay:function(){var e=$("#oe_menu"),t=$("#admin-alerts"),a=$("nav.main-header"),n=a.outerHeight()+a.offset().top;t.length&&(n=t.outerHeight()+t.offset().top),e.outerHeight()+n<$(window).height()?e.css({position:"fixed",top:n}):(e.css({position:"",top:""}),e.offset().top<$(window).scrollTop()&&$("html, body").animate({scrollTop:$("#oe_menu").offset().top},1e3))},_showSidebar:function(e,a){e.addClass("sidebar-on").removeClass("sidebar-off"),a.find("li.current ul").show(),t.helper.setStorageValue("sidebar-pref","sidebar-on",60)},_closeSidebar:function(e,a){e.removeClass("sidebar-on").addClass("sidebar-off"),a.find("li ul").hide(),t.helper.setStorageValue("sidebar-pref","sidebar-off",60)},_handleAlert:function(e){var t=$(e).closest(".alert-box"),a=t.data("alert-name");if(a)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:a}}).done(function(){t.slideUp(1e3),t.parent().children().length<=1&&(t.closest("div.ui-dialog-content").dialog("close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),t.remove()}).fail(function(e,t,a){console.debug("problem deleting an alert: "+a)})},setupAlerts:function(){var e=this;$("a#alerts").click(function(e){e.preventDefault(),$("#alert-dialog").dialog()}),$(".alert-msg a").click(function(e){e.preventDefault(),t.view.handleAlert(e.target)}),$(".alert-icon,.alert-remove").click(function(t){t.preventDefault(),e._handleAlert(t.target)})}}}(this,jQuery);
