/*!
CMSMS Altbier theme functions v.1.0
(C) 2018-2019 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
!function(e,$){"use strict";var n=e.AC={};$(function(){n.helper.init(),n.view.init()}),n.helper={Initwidth:$(window).width(),init:function(){$('a[rel="external"]').attr("target","_blank"),$("input.defaultfocus:eq(0), input[autofocus]").focus(),this._isLocalStorage()||this.loadScript("themes/Altbier/includes/jquery.cookie.min.js")},loadScript:function(e,n,t){var a=!0,i=null;return $.isFunction(n)?(i=n,a=t||a):(a=n||a,i=t||i),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax(e,{dataType:"script",async:!1,cache:a}).done(i)},setStorageValue:function(e,n,t){var a=(new Date).getTime()+24*t*60*60*1e3,i={};try{!0===this._isLocalStorage()?(localStorage.removeItem(e),i=null!==t?{value:n,timestamp:a}:{value:n,timestamp:""},localStorage.setItem(e,JSON.stringify(i))):(null!==t&&(i={expires:t}),"undefined"!==$.fn.cookie&&$.cookie(e,n,i))}catch(t){console.log("localStorage Error: set("+e+", "+n+")"),console.log(t)}},getStorageValue:function(e){var n,t="";return this._isLocalStorage()?null!==(t=JSON.parse(localStorage.getItem(e)))&&t.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==t&&(n=t.value):"undefined"!==$.fn.cookie&&(n=$.cookie(e)),n},removeStorageValue:function(e){this._isLocalStorage()?localStorage.removeItem(e):$.cookie(e,null)},equalHeight:function(e){var n=0;e.each(function(){var e=$(this).height();e>n&&(n=e)}),e.height(n)},_isLocalStorage:function(){return"undefined"!=typeof Storage},_isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in window||navigator.msMaxTouchPoints>0||window.DocumentTouch&&document instanceof DocumentTouch))return!0}},n.view={init:function(){var e=this,n=$(".toggle-button"),t=$("#ac_container"),a=$("#ac_pagemenu");n.on("click",function(n){n.preventDefault(),t.hasClass("sidebar-on")?(e._closeSidebar(t,a),e.show_submenus=!1):(e._showSidebar(t,a),e.show_submenus=!0)}),e.toggleSubMenu(a,50),e.showNotifications(),e.setUIButtons(),e.setupAlerts(),e.updateDisplay(),e.handleSidebar(t),$(window).resize(function(){e.handleSidebar(t),e.updateDisplay()})},handleSidebar:function(e){var t=$(window).outerWidth();"sidebar-off"===n.helper.getStorageValue("sidebar-pref")||t<=767?(e.addClass("sidebar-off").removeClass("sidebar-on"),n.view.init.show_submenus=!1):(e.addClass("sidebar-on").removeClass("sidebar-off"),n.view.init.show_submenus=!0)},preventSubMenu:function(e){$(e).find(".nav > span.open-nav").on("click",function(e){return!0})},toggleSubMenu:function(e,t){var a=this;$(e).find(".nav  > span.open-nav").on("click",function(i){if(n.view.init.show_submenus){i.preventDefault();var o=$(this),s=o.hasClass("open-sub"),r=o.next(),l=[];return!1===r.is(":visible")&&l.push(e.find("ul").slideUp(t)),e.find(".nav").removeClass("current").find("span").removeClass("open-sub"),o.parent(".nav").addClass("current"),s?l.push(r.slideToggle(t)):o.addClass("open-sub"),$.when.apply($,l).done(function(){a.updateDisplay()}),!1}return!0})},showNotifications:function(){"function"==typeof cms_notify_all&&cms_notify_all(),$(document).on("click",".close-warning",function(){$(this).parent().hide(),$(this).parent().remove()});var e=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){n.helper.setStorageValue(e,"hidden",60)}),"hidden"===n.helper.getStorageValue(e)&&$(".pagewarning").addClass("hidden"),$(".message:not(.no-slide)").click(function(){$(".message").slideUp()}),$(".message:not(.no-slide), .pageerrorcontainer:not(.no-slide), .pagemcontainer:not(.no-slide)").each(function(){var e=$(this);$(e).hide().slideDown(1e3,function(){window.setTimeout(function(){e.slideUp()},1e4)})}),$(document).on("cms_ajax_apply",function(e){$('button[name="cancel"], button[name="m1_cancel"]').fadeOut(),$('button[name="cancel"], button[name="m1_cancel"]').button("option","label",e.close),$('button[name="cancel"], button[name="m1_cancel"]').fadeIn();var n="";"Success"===e.response?n='<aside class="message pagemcontainer" role="status"><span class="close-warning xhr">Close</span><p class="pagemessage">'+e.details+"</p></aside>":(n='<aside class="message pageerrorcontainer" role="alert"><span class="close-warning">Close</span><ul class="pageerror">',n+=e.details,n+="</ul></aside>"),$("body").append(n).slideDown(1e3,function(){window.setTimeout(function(){$(".message").slideUp(),$(".message").remove()},1e4)}),$(document).on("click",".close-warning",function(){$(".message").slideUp(),$(".message").remove()})})},setUIButtons:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){if(!this.value.trim())return!0;var e=$(this),n=e.data("uiIcon")||"ui-icon-circle-check",t=e.val(),a=$("<button />");e.hasClass("noautobtn")&&e.hasClass("no-ui-btn")||(e.is("[name*=apply]")?n=e.data("uiIcon")||"ui-icon-disk":e.is("[name*=cancel]")?n=e.data("uiIcon")||"ui-icon-circle-close":(e.is("[name*=resettodefault]")||"refresh"===e.attr("id"))&&(n=e.data("uiIcon")||"ui-icon-refresh")),e.is(":button")&&(t=e.text()),$(this.attributes).each(function(e,n){a.attr(n.name,n.value)}),a.button({icons:{primary:n},label:t}),e.replaceWith(a)}),$("a.pageback").addClass("ui-state-default ui-corner-all").prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},updateDisplay:function(){var e=$("#ac_menu"),n=$("#admin-alerts"),t=$("header.header"),a=t.outerHeight()+t.offset().top;n.length&&(a=n.outerHeight()+n.offset().top),e.outerHeight()+a<$(window).height()||e.offset().top<$(window).scrollTop()&&$("html, body").animate({scrollTop:$("#ac_menu").offset().top},1e3)},_showSidebar:function(e,t){e.addClass("sidebar-on").removeClass("sidebar-off"),t.find("li.current ul").show(),n.view.init.show_submenus=!0,n.helper.setStorageValue("sidebar-pref","sidebar-on",60)},_closeSidebar:function(e,t){e.removeClass("sidebar-on").addClass("sidebar-off"),t.find("li ul").hide(),n.view.init.show_submenus=!1,n.helper.setStorageValue("sidebar-pref","sidebar-off",60)},_handleAlert:function(e){var n=$(e).closest(".alert-box"),t=n.data("alert-name");if(t)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:t}}).fail(function(e,n,t){console.debug("problem deleting an alert: "+t)}).done(function(){n.slideUp(1e3),n.parent().children().length<=1&&(n.closest("div.ui-dialog-content").dialog("close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),n.remove()})},setupAlerts:function(){var e=this;$("a#alerts").click(function(e){e.preventDefault(),$("#alert-dialog").dialog()}),$(".alert-msg a").click(function(e){e.preventDefault(),n.view.handleAlert(e.target)}),$(".alert-icon,.alert-remove").click(function(n){n.preventDefault(),e._handleAlert(n.target)})}}}(this,jQuery);
