# This file details settings for Apache web-server, to be included in one or more
# .htaccess files, each in a relevant website folder.

# For Internet Information Server, the equivalent of .htaccess is web.config, an
# XML file like:
# <?xml version="1.0" encoding="utf-8" ?>
# <configuration>
#  <system.webServer>
#   settings ...
#  </system.webServer>
# </configuration>

# You can read about web.config at
# http://msdn.microsoft.com/en-us/library/w7w4sb0w.aspx
# and
# http://support.microsoft.com/kb/815179

# A tutorial:
# http://www.saotn.org/convert-apache-htaccess-iis-web-config/#.U_QdKvldUqx

# Online .htaccess to web.config conversion tools exist e.g.
# http://cbsa.com.br/tools/online-convert-htaccess-to-web-config.aspx

# Internet Information Services Maanger v.7+ can import .htaccess files


# The following are Apache-specific settings to optimize traffic and configuration for a CMS Made Simpleâ„¢ website.
# Many options are disabled by default, as some hosts do not allow overriding some of these settings in an .htaccess file.

# Attempt to override some PHP settings.
# These settings may be helpful on some hosts if your default configuration does not meet
# CMSMS's minimum requirements, and your host has given your account appropriate permissions.
#
#php_value upload_max_filesize "10M"
#php_value session_save_path "tmp/cache"
#php_value session.cookie_httponly true
#php_flag magic_quotes_gpc Off
#php_flag register_globals Off
#php_flag session.use_trans_sid Off

#
# Disallow directory indexes. This can be an important security enhancement.
#
#Options -Indexes

#
# Disallow browser-interrogation of the type of signature.
#
ServerSignature Off

#
# Allow the server to follow symbolic links. This is usually not necessary.
#
#Options +FollowSymLinks

#
# Enables 'pretty' URLs. Only applicable if url_rewriting is set to 'mod_rewrite' in the config.php file
#
<IfModule rewrite_module>
	RewriteEngine on
	# If your CMSMS installation is in a subdirectory of your domain, you need to specify the relative path (from the root of the domain) here.
	# In example: RewriteBase /[subdirectory name]
	RewriteBase /
	
	# Rewrites URLs in the form of /parent/child/grandchild but only rewrites if the requested URL is not a file or directory.
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule ^(.+)$ index.php?page=$1 [QSA]
</IfModule>

#
# The following are security settings for files in your CMSMS install that should not be browsed directly.
# Adjust 'assets' to match actual site folder for assets
# Suffix-checks maybe not so useful, cuz malefactor can append &X=Y to URL
# CHECKME (lib|admin)/index.php admin/login.php

RedirectMatch 403 ^/.*\.htaccess$
RedirectMatch 403 ^/.*\.log$
RedirectMatch 403 ^/.*\.ini$
RedirectMatch 403 ^/.*config\.php$
RedirectMatch 403 ^.*/doc/.*$
RedirectMatch 403 ^.*/lib/.*$
RedirectMatch 403 ^.*/tmp/.*$
RedirectMatch 403 (?i)^.*/modules/.*\.(php|js|css|tpl)$
RedirectMatch 403 (?i)^.*/admin/.*\.(php|js|css|tpl)$
RedirectMatch 403 (?i)^.*/assets/.*\.(php|js|css|tpl)$
RedirectMatch 403 (?i)^.*/uploads/.*\.(php|js|css|tpl)$

#
# The following are performance optimizations and security enhancements for content that is served by your CMSMS installation.
#
<IfModule mod_headers.c>
    # Disable Last-Modified for performance
    Header unset Last-Modified
	# Disable ETags
	Header unset ETag
	FileEtag None
	# For Security
	Header set X-Frame-Options "SAMEORIGIN"
</IfModule>

#
# The following setups compression for content, if compression is enabled on the server.
#
<IfModule deflate_module>
	AddOutputFilterByType DEFLATE text/html text/css text/plain text/html text/xml image/gif image/jpeg image/png image/ico text/javascript application/x-javascript application/javascript application/json application/pdf image/svg+xml
</IfModule>

#
# The following allows the browser to cache images, scripts, stylesheets and videos. If the expires module is enabled on the server.
# Note, this applies to admin directory stuff too.
# however, for php files in the admin directory we explicitly st the header to not expire
#
<IfModule mod_expires.c>
	ExpiresActive On
	ExpiresDefault "access plus 1 month"
	# Set expires tags on various file types... so that the browser won't attempt to reload them.
	ExpiresByType image/jpg "access plus 1 year"
	ExpiresByType image/gif "access plus 1 year"
	ExpiresByType image/ico "access plus 1 year"
	ExpiresByType image/png "access plus 1 year"
	ExpiresByType image/svg+xml "access plus 1 year"
	ExpiresByType video/x-flv "access plus 1 year"
	ExpiresByType application/pdf "access plus 1 year"
	ExpiresByType application/x-shockwave-flash "access plus 1 year"
	ExpiresByType application/javascript "access plus 1 month"
	ExpiresByType application/x-javascript "access plus 1 month"
	ExpiresByType text/javascript "access plus 1 month"
	ExpiresByType text/css "access plus 1 month"
	<IfModule mod_headers.c>
		# Setting cache control to public allows proxy servers to cache the items too.
		Header set Cache-Control "public"
	</IfModule>
</IfModule>
