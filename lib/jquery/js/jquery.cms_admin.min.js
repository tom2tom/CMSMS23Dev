/*!
* CMS Made Simple Admin Functions
* (c) 2004-2013 CMS Made Simple
* License: GPL2+
*/
(function(c,$){"use strict";var a,h=function(){},e=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=e.length,f=(window.console=window.console||{});while(d--){a=e[d];if(!f[a]){f[a]=h}}var b=c.CMSMS_Admin||{};$(document).ready(function(){b.Loader.init()});b.namespace=function(m){var n=m.split("."),l=b,j,k;if(n[0]==="CMSMS_Admin"){n=n.slice(1)}for(j=0;j<n.length;j+=1){k=n[j];if(typeof l[k]==="undefined"){l[k]={}}l=l[k]}return l};var g=b.namespace("CMSMS_Admin.Loader");g.reload=function(){$(document).ajaxComplete(function(){b.Helper.cms_helpDialog();b.Helper.cms_initTooltips()})};g.init=function(){b.Loader.reload();b.Helper.cms_resizableTextArea();b.Helper.cms_helpDialog();b.Helper.cms_initTabs();b.Helper.cms_initModalDialog();b.Helper.cms_initTooltips();$("form").submit(function(k){if($(this).attr("novalidate")){return}var j=0;$("input[type=file]",this).each(function(l,m){if(m.files.length===0){return}j=j+m.files[0].size});if(typeof cms_data!="undefined"&&cms_data.max_upload_size&&(j>cms_data.max_upload_size)){alert(cms_data.lang_largeupload);return false}})};var i=b.namespace("CMSMS_Admin.Helper");i.cms_resizableTextArea=function(){var j=document.createElement("textarea");$("textarea").each(function(){var k=$(this);if((j.style.resize===undefined||k.hasClass("cms_resizable"))&&(!k.hasClass("MicroTiny"))&&(!k.hasClass("no-resize"))){k.resizable({handles:"se",ghost:true})}})};i.cms_helpDialog=function(){$(".cms_help img.cms_helpicon").on("click",function(){var j,p=$(this),n=p.parent().data(),q=n.cmshelpTitle,k=n.cmshelpKey;if(k.length&&$("#cmshelp_"+k).length===0){var m=k.indexOf("__"),l=k.substr(m+2),o=$('<div class="cms_helptext" title="'+cms_data.title_help+": "+q+'" id="cmshelp_'+k+'" style="display: none;"></div>');p.append(o);$.get(cms_data.ajax_help_url,{key:k},function(r){$("#cmshelp_"+k).html(r)})}$("#cmshelp_"+k).dialog()})};i.cms_initTabs=function(){function k(m){var l=$("#navt_tabs"),n=$("#navt_tabs, #page_tabs").find("div");if(l.length===0){l=$("#page_tabs")}l.find("div:eq("+m+")").mousedown()}var j=$("#navt_tabs, #page_tabs").find("div");j.mousedown(function(){var l=$(this);j.each(function(){var m=$(this);m.removeClass("active");$("#"+m.attr("id")+"_c").hide()});l.addClass("active");$("#"+l.attr("id")+"_c").show();return true});j.focus(function(l){$(this).addClass("focus")});j.blur(function(l){$(this).removeClass("focus")});j.keyup(function(l){if(l.keyCode==$.ui.keyCode.ENTER){var m=j.index(this);k(m)}});j.attr("tabindex","0");if(j.filter(".active").mousedown().length===0){k(0)}};i.cms_initModalDialog=function(){var j={};$(".dialog").each(function(){var l=$(this),k=$(this).prev(".open").attr("title");j[k]=l.dialog({autoOpen:false,modal:true})});$(document).on("click",".open",function(m){var l=$(this),k=l.attr("title");j[k].dialog("open").removeClass("invisible");m.preventDefault()})};i.cms_initTooltips=function(){$(".tooltip").tooltip({items:"[title], [data-cms-description], [data-cms-ajax]",content:function(n){var k=$(this),m=k.data(),l,j;if(k.is("[data-cms-description]")){l=m.cmsDescription;return l}if(k.is("[data-cms-ajax]")){j=m.cmsAjax;j+="&showtemplate=false";$.ajax({url:j,async:true,dataType:"html",error:function(o,q,p){f.log("Sorry. There was a error in your request: "+q+" "+p)},success:function(o){n(o)}})}if(k.is("[title]")){return k.attr("title")}}})};i.cms_jquiMarkup=function(){$("[data-jqui]").each(function(k,l){var j=$(l).data();$.each(j.jqui.split(/\s+/),function(m,n){$(l)[n](j)})})}}(this,jQuery));(function(c){var b="cmsms_checkall",d={target:"table"};function a(f,e){this.element=f;this.settings=c.extend({},d,e);this.defaults=d;this._name=b;this.init()}a.prototype={init:function(){this._toggle(this.element,this.settings.target)},_toggle:function(h,e){var g=c(h).closest(e),f=c(h);c("[type=checkbox]",g).not(f).click(function(){var j=c(this),i=j.prop("checked",!j.prop("checked"));f.prop("checked",false);j.prop("checked",!j.prop("checked"));j.trigger("cms_checkall_toggle",{checked:i})});f.on("click",function(){var i=f.is(":checked");c("[type=checkbox]",g).each(function(){var j=c(this);j.attr("checked",i);j.trigger("cms_checkall_toggle",{checked:i})})})}};c.fn[b]=function(e){return this.each(function(){if(!c.data(this,"plugin_"+b)){c.data(this,"plugin_"+b,new a(this,e))}})}}(jQuery));(function(a){a.widget("cmsms.cmsms_sortable_table",a.extend({},a.ui.sortable.prototype,{options:{actionurl:null,update:null,helper:null,callback:function(b){}},_create:function(){var b=this;this.element.data("sortable",this.element.data("cmsms_sortable_table"));this.options.update=function(c,d){b._update(b.options,b.element)};this.options.helper=this._uiFixHelper;return a.ui.sortable.prototype._create.apply(this,arguments)},_update:function(c,d){var b=c.actionurl,e=this.serialize(a(d));a(d).find("tr:even").attr("class","row1");a(d).find("tr:odd").attr("class","row2");a.post(b+"&"+e,function(f){c.callback(f)})},serialize:function(d){var b=this._getItemsAsjQuery(d&&d.connected),c=[];d=d||{};a(b).each(function(){var e=(a(d.item||this).attr(d.attribute||"id")||"").match(d.expression||(/(.+)[\-=_](.+)/));if(e){c.push((d.key||e[1]+"[]")+"="+(d.key&&d.expression?e[1]:e[2]))}});if(!c.length&&d.key){c.push(d.key+"=")}return c.join("&")},_uiFixHelper:function(c,b){b.children().each(function(){a(this).width(a(this).width())});return b}}));a.cmsms.cmsms_sortable_table.prototype.options=a.extend({},a.ui.sortable.prototype.options,a.cmsms.cmsms_sortable_table.prototype.options)}(jQuery));function togglecollapse(a){$("#"+a).toggle()}function cms_alert(c,b){var a=$.Deferred();if(typeof(c)==="undefined"){return}if(typeof(b)==="undefined"){b=cms_lang("alert")}if($("#cmsms_errorDialog").length===0){$('<div style="display: none;"><div id="cmsms_errorDialog"></div></div>').insertAfter("body")}$("#cmsms_errorDialog").html(c);$("#cmsms_errorDialog").dialog({modal:true,title:b,close:function(d,e){a.resolve()}});return a.promise()}function cms_confirm(d,c,e,b){var a=new $.Deferred();if(typeof(d)==="undefined"){return}if(typeof(c)==="undefined"){c=cms_lang("confirm")}if(typeof(e)==="undefined"){e=cms_data.lang_yes}if(typeof(b)==="undefined"){b=cms_data.lang_no}if($("#cmsms_confirmDialog").length===0){$('<div style="display: none;"><div id="cmsms_confirmDialog"></div></div>').insertAfter("body")}$("#cmsms_confirmDialog").html(d);$("#cmsms_confirmDialog").dialog({modal:true,title:c,buttons:[{text:e,icons:{primary:"ui-icon-check"},click:function(f){$(this).dialog("close");a.resolve(e)}},{text:b,icons:{primary:"ui-icon-close"},click:function(f){$(this).dialog("close");a.reject(b)}}]});return a.promise()}function cms_busy(b){if(typeof b=="undefined"){b=true}var c=$("#cms_busy");if(!c.length){var a=$("<div/>").attr("id","cms_busy").addClass("busy").hide();$("body").append(a)}if(b){setTimeout(function(){c.show()},10)}else{if(c.length){c.hide()}}};