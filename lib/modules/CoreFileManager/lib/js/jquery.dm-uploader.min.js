/*!
jQuery Ajax File Uploader Widget V.1.0.2 <https://github.com/danielm/uploader>
(C) 2013-2018 Daniel Morales <daniel85mg@gmail.com>
License MIT
*/
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports!=="undefined"){module.exports=a(require("jquery"))}else{a(window.jQuery)}}}(function($){"use strict";var c="dmUploader";var e={PENDING:0,UPLOADING:1,COMPLETED:2,FAILED:3,CANCELLED:4};var d={auto:true,queue:true,dnd:true,hookDocument:true,multiple:true,url:document.URL,method:"POST",extraData:{},headers:{},dataType:null,fieldName:"file",maxFileSize:0,allowedTypes:"*",extFilter:null,onInit:function(){},onComplete:function(){},onFallbackMode:function(){},onNewFile:function(){},onBeforeUpload:function(){},onUploadProgress:function(){},onUploadSuccess:function(){},onUploadCanceled:function(){},onUploadError:function(){},onUploadComplete:function(){},onFileTypeError:function(){},onFileSizeError:function(){},onFileExtError:function(){},onDragEnter:function(){},onDragLeave:function(){},onDocumentDragEnter:function(){},onDocumentDragLeave:function(){}};var b=function(f,g){this.data=f;this.widget=g;this.jqXHR=null;this.status=e.PENDING;this.id=Math.random().toString(36).substr(2)};b.prototype.upload=function(){var g=this;if(!g.canUpload()){if(g.widget.queueRunning&&g.status!==e.UPLOADING){g.widget.processQueue()}return false}var f=new FormData();f.append(g.widget.settings.fieldName,g.data);var h=g.widget.settings.extraData;if(typeof(h)==="function"){h=h.call(g.widget.element,g.id)}$.each(h,function(i,j){f.append(i,j)});g.status=e.UPLOADING;g.widget.activeFiles++;g.widget.settings.onBeforeUpload.call(g.widget.element,g.id);g.jqXHR=$.ajax({url:g.widget.settings.url,type:g.widget.settings.method,dataType:g.widget.settings.dataType,data:f,headers:g.widget.settings.headers,cache:false,contentType:false,processData:false,forceSync:false,xhr:function(){return g.getXhr()},success:function(i){g.onSuccess(i)},error:function(k,i,j){g.onError(k,i,j)},complete:function(){g.onComplete()}});return true};b.prototype.onSuccess=function(f){this.status=e.COMPLETED;this.widget.settings.onUploadSuccess.call(this.widget.element,this.id,f)};b.prototype.onError=function(h,f,g){if(this.status!==e.CANCELLED){this.status=e.FAILED;this.widget.settings.onUploadError.call(this.widget.element,this.id,h,f,g)}};b.prototype.onComplete=function(){this.widget.activeFiles--;if(this.status!==e.CANCELLED){this.widget.settings.onUploadComplete.call(this.widget.element,this.id)}if(this.widget.queueRunning){this.widget.processQueue()}else{if(this.widget.settings.queue&&this.widget.activeFiles===0){this.widget.settings.onComplete.call(this.element)}}};b.prototype.getXhr=function(){var f=this;var g=$.ajaxSettings.xhr();if(g.upload){g.upload.addEventListener("progress",function(k){var j=0;var h=k.loaded||k.position;var i=k.total||k.totalSize;if(k.lengthComputable){j=Math.ceil(h/i*100)}f.widget.settings.onUploadProgress.call(f.widget.element,f.id,j)},false)}return g};b.prototype.cancel=function(g){g=(typeof g==="undefined"?false:g);var f=this.status;if(f===e.UPLOADING||(g&&f===e.PENDING)){this.status=e.CANCELLED}else{return false}this.widget.settings.onUploadCanceled.call(this.widget.element,this.id);if(f===e.UPLOADING){this.jqXHR.abort()}return true};b.prototype.canUpload=function(){return(this.status===e.PENDING||this.status===e.FAILED)};var a=function(g,f){this.element=$(g);this.settings=$.extend({},d,f);if(!this.checkSupport()){$.error("Browser not supported by jQuery.dmUploader");this.settings.onFallbackMode.call(this.element);return false}this.init();return this};a.prototype.checkSupport=function(){if(typeof window.FormData==="undefined"){return false}var f=new RegExp("/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1.0|2.0|2.5|3.0))/");if(f.test(window.navigator.userAgent)){return false}return !$('<input type="file" />').prop("disabled")};a.prototype.init=function(){var g=this;this.queue=[];this.queuePos=-1;this.queueRunning=false;this.activeFiles=0;this.draggingOver=0;this.draggingOverDoc=0;var f=g.element.is("input[type=file]")?g.element:g.element.find("input[type=file]");if(f.length>0){f.prop("multiple",this.settings.multiple);f.on("change."+c,function(h){var i=h.target&&h.target.files;if(!i||!i.length){return}g.addFiles(i);$(this).val("")})}if(this.settings.dnd){this.initDnD()}if(f.length===0&&!this.settings.dnd){$.error("Markup error found by jQuery.dmUploader");return null}this.settings.onInit.call(this.element);return this};a.prototype.initDnD=function(){var f=this;f.element.on("drop."+c,function(g){g.preventDefault();if(f.draggingOver>0){f.draggingOver=0;f.settings.onDragLeave.call(f.element)}var i=g.originalEvent&&g.originalEvent.dataTransfer;if(!i||!i.files||!i.files.length){return}var h=[];if(f.settings.multiple){h=i.files}else{h.push(i.files[0])}f.addFiles(h)});f.element.on("dragenter."+c,function(g){g.preventDefault();if(f.draggingOver===0){f.settings.onDragEnter.call(f.element)}f.draggingOver++});f.element.on("dragleave."+c,function(g){g.preventDefault();f.draggingOver--;if(f.draggingOver===0){f.settings.onDragLeave.call(f.element)}});if(!f.settings.hookDocument){return}$(document).off("drop."+c).on("drop."+c,function(g){g.preventDefault();if(f.draggingOverDoc>0){f.draggingOverDoc=0;f.settings.onDocumentDragLeave.call(f.element)}});$(document).off("dragenter."+c).on("dragenter."+c,function(g){g.preventDefault();if(f.draggingOverDoc===0){f.settings.onDocumentDragEnter.call(f.element)}f.draggingOverDoc++});$(document).off("dragleave."+c).on("dragleave."+c,function(g){g.preventDefault();f.draggingOverDoc--;if(f.draggingOverDoc===0){f.settings.onDocumentDragLeave.call(f.element)}});$(document).off("dragover."+c).on("dragover."+c,function(g){g.preventDefault()})};a.prototype.releaseEvents=function(){this.element.off("."+c);this.element.find("input[type=file]").off("."+c);if(this.settings.hookDocument){$(document).off("."+c)}};a.prototype.validateFile=function(f){if((this.settings.maxFileSize>0)&&(f.size>this.settings.maxFileSize)){this.settings.onFileSizeError.call(this.element,f);return false}if((this.settings.allowedTypes!=="*")&&!f.type.match(this.settings.allowedTypes)){this.settings.onFileTypeError.call(this.element,f);return false}if(this.settings.extFilter!==null){var g=f.name.toLowerCase().split(".").pop();if($.inArray(g,this.settings.extFilter)<0){this.settings.onFileExtError.call(this.element,f);return false}}return new b(f,this)};a.prototype.addFiles=function(j){var f=0;for(var h=0;h<j.length;h++){var g=this.validateFile(j[h]);if(!g){continue}var k=this.settings.onNewFile.call(this.element,g.id,g.data);if(k===false){continue}if(this.settings.auto&&!this.settings.queue){g.upload()}this.queue.push(g);f++}if(f===0){return this}if(this.settings.auto&&this.settings.queue&&!this.queueRunning){this.processQueue()}return this};a.prototype.processQueue=function(){this.queuePos++;if(this.queuePos>=this.queue.length){if(this.activeFiles===0){this.settings.onComplete.call(this.element)}this.queuePos=(this.queue.length-1);this.queueRunning=false;return false}this.queueRunning=true;return this.queue[this.queuePos].upload()};a.prototype.restartQueue=function(){this.queuePos=-1;this.queueRunning=false;this.processQueue()};a.prototype.findById=function(h){var g=false;for(var f=0;f<this.queue.length;f++){if(this.queue[f].id===h){g=this.queue[f];break}}return g};a.prototype.cancelAll=function(){var g=this.queueRunning;this.queueRunning=false;for(var f=0;f<this.queue.length;f++){this.queue[f].cancel()}if(g){this.settings.onComplete.call(this.element)}};a.prototype.startAll=function(){if(this.settings.queue){this.restartQueue()}else{for(var f=0;f<this.queue.length;f++){this.queue[f].upload()}}};a.prototype.methods={start:function(g){if(this.queueRunning){return false}var f=false;if(typeof g!=="undefined"){f=this.findById(g);if(!f){$.error("File not found in jQuery.dmUploader");return false}}if(f){if(f.status===e.CANCELLED){f.status=e.PENDING}return f.upload()}this.startAll();return true},cancel:function(g){var f=false;if(typeof g!=="undefined"){f=this.findById(g);if(!f){$.error("File not found in jQuery.dmUploader");return false}}if(f){return f.cancel(true)}this.cancelAll();return true},reset:function(){this.cancelAll();this.queue=[];this.queuePos=-1;this.activeFiles=0;return true},destroy:function(){this.cancelAll();this.releaseEvents();this.element.removeData(c)}};$.fn.dmUploader=function(g){var f=arguments;if(typeof g==="string"){this.each(function(){var h=$.data(this,c);if(h instanceof a){if(typeof h.methods[g]==="function"){h.methods[g].apply(h,Array.prototype.slice.call(f,1))}else{$.error("Method "+g+" does not exist in jQuery.dmUploader")}}else{$.error("Unknown plugin data found by jQuery.dmUploader")}})}else{return this.each(function(){if(!$.data(this,c)){$.data(this,c,new a(this,g))}})}}}));