/*!
jQuery Resize And Crop (jrac) plugin V.1.0.2 <https://github.com/trepmag/jrac>
(C) 2011 Cedric Gampert <cgampert@gmail.com>
License: GPL2
*/
(function($){$.fn.jrac=function(a){var b={crop_width:200,crop_height:100,crop_x:0,crop_y:0,crop_resize:true,crop_aspect_ratio:null,image_width:null,image_height:null,zoom_min:100,zoom_max:3000,zoom_label:"",viewport_image_surrounding:false,viewport_width:null,viewport_height:null,viewport_resize:true,viewport_content_left:0,viewport_content_top:0,viewport_onload:null};return this.each(function(){if(!$(this).is("img")){return}var d=false;if(typeof(a)=="object"){$.extend(b,a)}else{if(a=="destroy"){d=true}}var e=$(this);var j=false;if(e.parent().hasClass("jrac_viewport")){j=true}if(j&&d){e.draggable("destroy");e.parent().find(".jrac_crop").remove();e.parent().parent().find(".jrac_zoom_slider").remove();e.parent().append(e.data("original"));e.parent().unwrap();e.unwrap();e.remove()}else{e.data("original",e.clone())}if(d){return}if(!j){e.hide().css("position","absolute").wrap('<div class="jrac_container"><div class="jrac_viewport"></div></div>')}var i=e.parent();var h=i.parent();var f=$('<div class="jrac_loading" />');i.append(f);var c=function(){$.extend(e,{scale_proportion_locked:true,originalWidth:e.width(),originalHeight:e.height()});e.width(b.image_width).height(b.image_height);if(b.viewport_image_surrounding){i.width(e.width()).height(e.height())}else{i.width(b.viewport_width).height(b.viewport_height)}e.css({left:b.viewport_content_left,top:b.viewport_content_top});if(!j){if(b.zoom_label){var l=$('<div class="jrac_zoom_slider_label">'+b.zoom_label+"</div>");h.append(l)}var k=$('<div class="jrac_zoom_slider"><div class="ui-slider-handle"></div></div>').slider({value:e.width(),min:b.zoom_min,max:b.zoom_max,start:function(n,o){$.extend(k,{on_start_width_value:o.value,on_start_height_value:e.height()})},slide:function(o,p){var n=Math.round(k.on_start_height_value*p.value/k.on_start_width_value);e.height(n);e.width(p.value);i.observator.notify("jrac_image_height",n);i.observator.notify("jrac_image_width",p.value)}});h.append(k);if(b.viewport_resize){i.resizable()}e.draggable({drag:function(n,o){if(o.position.left!=o.originalPosition.left){i.observator.notify("jrac_crop_x",i.observator.crop_position_x())}if(o.position.top!=o.originalPosition.top){i.observator.notify("jrac_crop_y",i.observator.crop_position_y())}}});var m=$('<div class="jrac_crop"><div class="jrac_crop_drag_handler"></div></div>').css({width:b.crop_width,height:b.crop_height,left:b.crop_x+b.viewport_content_left,top:b.crop_y+b.viewport_content_top}).draggable({containment:i,handle:"div.jrac_crop_drag_handler",drag:function(n,o){if(o.position.left!=o.originalPosition.left){i.observator.notify("jrac_crop_x",i.observator.crop_position_x())}if(o.position.top!=o.originalPosition.top){i.observator.notify("jrac_crop_y",i.observator.crop_position_y())}}});if(b.crop_resize){m.resizable({containment:i,aspectRatio:b.crop_aspect_ratio,resize:function(n,o){if(o.size.width!=o.originalSize.width){i.observator.notify("jrac_crop_width",m.width())}if(o.size.height!=o.originalSize.height){i.observator.notify("jrac_crop_height",m.height())}}})}i.append(m)}$.extend(i,{$container:h,$image:e,$crop:m,$zoom_widget:k,observator:{items:{},register:function(o,n,p){if(o&&n){this.items[o]={element:n,callback:p}}},unregister:function(n){delete this.items[n]},notify:function(p,o){if(this.items[p]){var n=this.items[p].element;var q=this.items[p].callback;n.trigger(p,[i,o]);if($.isFunction(q)){q.call(i,p,n,o)}}e.trigger("jrac_events",[i])},notify_all:function(){this.notify("jrac_crop_x",this.crop_position_x());this.notify("jrac_crop_y",this.crop_position_y());this.notify("jrac_crop_width",m.width());this.notify("jrac_crop_height",m.height());this.notify("jrac_image_width",e.width());this.notify("jrac_image_height",e.height())},crop_position_x:function(){return m.position().left-e.position().left},crop_position_y:function(){return m.position().top-e.position().top},crop_consistent:function(){return this.crop_position_x()>=0&&this.crop_position_y()>=0&&this.crop_position_x()+m.width()+parseInt(m.css("border-width"),10)*2<=e.width()&&this.crop_position_y()+m.height()+parseInt(m.css("border-width"),10)*2<=e.height()},set_property:function(p,q){q=parseInt(q);if(isNaN(q)){return}switch(p){case"jrac_crop_x":m.css("left",q+e.position().left);break;case"jrac_crop_y":m.css("top",q+e.position().top);break;case"jrac_crop_width":m.width(q);break;case"jrac_crop_height":m.height(q);break;case"jrac_image_width":if(e.scale_proportion_locked){var n=Math.round(e.height()*q/e.width());e.height(n);this.notify("jrac_image_height",n)}e.width(q);k.slider("value",q);break;case"jrac_image_height":if(e.scale_proportion_locked){var o=Math.round(e.width()*q/e.height());e.width(o);this.notify("jrac_image_width",o);k.slider("value",o)}e.height(q);break}this.notify(p,q)}}});f.hide();f.remove();e.show();if($.isFunction(b.viewport_onload)){b.viewport_onload.call(i);i.observator.notify_all()}};var g=e.attr("src");if(/^data:image/.test(g)){c()}else{g=g+(g.search(/\?/)<0?"?":"&")+"jracrandom="+(new Date()).getTime();$("<img>").attr("src",g).load(c)}})}})(jQuery);