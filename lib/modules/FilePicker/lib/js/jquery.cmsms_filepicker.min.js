!function($){$.widget("cmsms.filepicker",{options:{},_destroy:function(){this._settings.button.remove(),this._settings.iframe.remove(),this._settings.iframe=this._settings.container=this._settings.popup=this._settings.button=null,this.element.removeAttr("data-cmsms-i").removeAttr("readonly").removeClass("cmsfp cmsfp_elem")},_uniqid:function(){return"i"+(new Date).getTime().toString(16)},_about_clear:function(){this.element.val().length>0?this._settings.clear.show():this._settings.clear.hide()},_create:function(){this._settings={};var t=this;if(void 0===this.options.start_path&&(this.options.start_path=cms_data.root_url),this._settings.btn_label=void 0!==this.options.btn_label?this.options.btn_label:cms_data.lang_choose+"...",this._settings.button=$("<button/>").text(this._settings.btn_label).addClass("adminsubmit cmsfp cmsfp-choose"),this.element.attr("readonly","readonly").addClass("cmsfp cmsfp_elem"),this.element.after(this._settings.button),this.element.after(" "),void 0!==this.options.required&&this.options.required)this.element.prop("required",!0);else{var s;s=this.options.remove_label?this.options.remove_label:"Clear";var e=this._settings.clear=$("<button/>").text(s).addClass("adminsubmit cmsfp cmsfp_clear");this.options.remove_title&&e.attr("title",this.options.remove_title),this._settings.button.after(e),this._settings.button.after(" "),this.element.prop("required",!1)}if(this._settings.inst=this.element.attr("data-cmsfp-instance"),!this._settings.inst){var i=this._uniqid();this._settings.inst=i,this.element.attr("data-cmsfp-instance",i)}if(this._settings.url=this.options.url,!this._settings.url){if(void 0===cms_data.filepicker_url||!cms_data.filepicker_url)throw"No filepicker_url in the cms_data class";this._settings.url=cms_data.filepicker_url}for(var n in this._settings.url+="&inst="+this._settings.inst,this.options)if(n.startsWith("param_")){var a=this.options[n];n=n.substr(6),this._settings.url+="&"+n+"="+a}this.element.on("click",function(s){s.preventDefault(),t.open()}),this._settings.button.on("click",function(s){s.preventDefault(),t.open()}),this._settings.clear&&this._settings.clear.on("click",function(s){s.preventDefault(),t.element.val(""),t._about_clear(),t.element.trigger("change")}),this.element.on("cmsfp:change",function(s,e){t._setOption("value",e),t._about_clear(),t.close(),t.element.trigger("change")}),this.options.value?this._setOption("value",this.options.value):this.render()},_setOption:function(t,s){"value"===t&&this.element.val(s),this.render()},_create_popup:function(){if(!this._settings.container){var t=this,s=this.options.title;s||(void 0!==cms_data.lang_select_file&&(s=cms_data.lang_select_file),s||(s="Select a File")),this._settings.iframe=$("<iframe/>").attr("src",this._settings.url).addClass("cmsfp cmsfp_frame"),this._settings.iframe.attr("data-cmsfp-inst",this._settings.inst).attr("name","x"+Date.now()),this._settings.container=$("<div/>").addClass("cmsfp cmsms-fp_dlg").append(this._settings.iframe).attr("title",s),$("body",document).append(this._settings.container),this._settings.popup=cms_dialog(this._settings.container,{autoOpen:!1,width:.8*$(window).width(),height:.6*$(window).height(),draggable:!0,dialogClass:"cmsms-fp_dlg",resizable:!1,close:function(s,e){t.close()}})}},_relativePath:function(t,s){if(void 0===s&&(t.startsWith(cms_data.uploads_url)?s=cms_data.uploads_url:t.startsWith(cms_data.root_url)&&(s=cms_data.root_url)),t.startsWith(s)){var e=t.substr(s.length);return e.startsWith("/")&&(e=e.substr(1)),e}},render:function(){this._about_clear()},close:function(){this._settings.popup.dialog("destroy"),this._settings.container.remove(),this._settings.popup=null,this._settings.container=null},open:function(){this._create_popup(),this._settings.popup.dialog("open")},_noop:function(){}})}(jQuery);
