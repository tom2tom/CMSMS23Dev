/*!
jQuery Ajax File Uploader Widget V.1.1.0 <https://github.com/danielm/uploader>
(C) 2013-2020 Daniel Morales <daniel85mg@gmail.com>
License MIT
*/
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(window.jQuery)}(function($){"use strict";var e="dmUploader",t=0,n=1,i=2,s=3,o=4,r=function(e,n){this.data=e,this.widget=n,this.jqXHR=null,this.status=t;var i=Math.random();this.id=(i+10*i).toString(36)};r.prototype.upload=function(){var e=this;if(!e.canUpload())return e.widget.queueRunning&&e.status!==n&&e.widget.processQueue(),!1;var t=new FormData;t.append(e.widget.settings.fieldName,e.data);var i=e.widget.settings.extraData;return"function"==typeof i&&(i=i.call(e.widget.element,e.id)),$.each(i,function(e,n){t.append(e,n)}),e.status=n,e.widget.activeFiles++,e.widget.settings.onBeforeUpload.call(e.widget.element,e.id),e.jqXHR=$.ajax({url:e.widget.settings.url,type:e.widget.settings.method,dataType:e.widget.settings.dataType,data:t,headers:e.widget.settings.headers,cache:!1,contentType:!1,processData:!1,forceSync:!1,xhr:function(){return e.getXhr()}}),e.jqXHR.done(function(t,n,i){e.onSuccess(t)}).fail(function(t,n,i){e.onError(t,n,i)}).always(function(t,n,i){e.onComplete()}),!0},r.prototype.onSuccess=function(e){this.status=i,this.widget.settings.onUploadSuccess.call(this.widget.element,this.id,e)},r.prototype.onError=function(e,t,n){this.status!==o&&(this.status=s,this.widget.settings.onUploadError.call(this.widget.element,this.id,e,t,n))},r.prototype.onComplete=function(){this.widget.activeFiles--,this.status!==o&&this.widget.settings.onUploadComplete.call(this.widget.element,this.id),this.widget.queueRunning?this.widget.processQueue():this.widget.settings.queue&&0===this.widget.activeFiles&&this.widget.settings.onComplete.call(this.element)},r.prototype.getXhr=function(){var e=this,t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){var n=0,i=t.loaded||t.position,s=t.total||t.totalSize;t.lengthComputable&&(n=Math.ceil(i/s*100)),e.widget.settings.onUploadProgress.call(e.widget.element,e.id,n)},!1),t},r.prototype.cancel=function(e){e=void 0!==e&&e;var i=this.status;return!!(i===n||e&&i===t)&&(this.status=o,this.widget.settings.onUploadCanceled.call(this.widget.element,this.id),i===n&&this.jqXHR.abort(),!0)},r.prototype.canUpload=function(){return this.status===t||this.status===s};var l=function(e,t){return this.element=$(e),this.settings=$.extend({},$.fn.dmUploader.defaults,t||{}),this.checkSupport()?(this.init(),this):($.error("Browser not supported by the dmUploader plugin"),this.settings.onFallbackMode.call(this.element),!1)};l.prototype.checkSupport=function(){return void 0!==window.FormData&&(!new RegExp("/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1.0|2.0|2.5|3.0))/").test(window.navigator.userAgent)&&!$('<input type="file" />').prop("disabled"))},l.prototype.init=function(){this.queue=[],this.queuePos=-1,this.queueRunning=!1,this.activeFiles=0,this.draggingOver=0,this.draggingOverDoc=0;var e=null;if(this.settings.inputFile&&((e=this.settings.inputFile)instanceof $||(e=$(e)),e.is("input[type=file]")||(e=null)),null===e&&(e=this.element.is("input[type=file]")?this.element:this.element.find("input[type=file]")),e.length>0){if(e.prop("multiple",this.settings.multiple),"*"!==this.settings.allowedTypes||this.settings.extFilter){var t="*"!==this.settings.allowedTypes?this.settings.allowedTypes:"";this.settings.extFilter&&(this.settings.extFilter.forEach(function(e){"."===e[0]?t+=","+e:t+=",."+e}),","===t[0]&&(t=t.substring(1))),e.prop("accept",t)}else e.prop("accept","");var n=this;e.on("change.dmUploader",function(e){var t=e.target&&e.target.files;t&&t.length&&(n.addFiles(t),$(this).val(""))})}return this.settings.dnd&&this.initDnD(),0!==e.length||this.settings.dnd?(this.settings.onInit.call(this.element),this):($.error("Markup error found by the dmUploader plugin"),null)},l.prototype.initDnD=function(){var e=this;this.element.on("drop.dmUploader",function(t){t.preventDefault(),e.draggingOver>0&&(e.draggingOver=0,e.settings.onDragLeave.call(e.element));var n=t.originalEvent&&t.originalEvent.dataTransfer;if(n&&n.files&&n.files.length){var i=[];e.settings.multiple?i=n.files:i.push(n.files[0]),e.addFiles(i)}}),this.element.on("dragenter.dmUploader",function(t){t.preventDefault(),0===e.draggingOver&&e.settings.onDragEnter.call(e.element),e.draggingOver++}),this.element.on("dragleave.dmUploader",function(t){t.preventDefault(),e.draggingOver--,0===e.draggingOver&&e.settings.onDragLeave.call(e.element)}),this.settings.hookDocument&&($(document).off("drop.dmUploader").on("drop.dmUploader",function(t){t.preventDefault(),e.draggingOverDoc>0&&(e.draggingOverDoc=0,e.settings.onDocumentDragLeave.call(e.element))}),$(document).off("dragenter.dmUploader").on("dragenter.dmUploader",function(t){t.preventDefault(),0===e.draggingOverDoc&&e.settings.onDocumentDragEnter.call(e.element),e.draggingOverDoc++}),$(document).off("dragleave.dmUploader").on("dragleave.dmUploader",function(t){t.preventDefault(),e.draggingOverDoc--,0===e.draggingOverDoc&&e.settings.onDocumentDragLeave.call(e.element)}),$(document).off("dragover.dmUploader").on("dragover.dmUploader",function(e){e.preventDefault()}))},l.prototype.releaseEvents=function(){this.element.off(".dmUploader"),this.element.find("input[type=file]").off(".dmUploader"),this.settings.hookDocument&&$(document).off(".dmUploader")},l.prototype.validateFile=function(e){if(this.settings.maxFileSize>0&&e.size>this.settings.maxFileSize)return this.settings.onFileSizeError.call(this.element,e),!1;if("*"!==this.settings.allowedTypes&&!this.settings.allowedTypes.split(",").some(function(t){return e.type.match(t)}))return this.settings.onFileTypeError.call(this.element,e),!1;if(this.settings.extFilter){var t="\\."+this.settings.extFilter.join(".").replace(/\./g,"\\."),n="\\."+e.name.split(".").pop();if(!new RegExp(n,"i").test(t))return this.settings.onFileExtError.call(this.element,e),!1}return new r(e,this)},l.prototype.addFiles=function(e){var t,n,i=0;for(t=0,n=e.length;t<n;t++){var s=this.validateFile(e[t]);if(s)!1!==this.settings.onNewFile.call(this.element,s.id,s.data)&&(this.settings.auto&&!this.settings.queue&&(0===i&&this.settings.onBegin.call(this.element),s.upload()),this.queue.push(s),i++)}return 0===i?this:(this.settings.auto&&this.settings.queue&&!this.queueRunning&&(this.settings.onBegin.call(this.element),this.processQueue()),this)},l.prototype.processQueue=function(){return this.queuePos++,this.queuePos>=this.queue.length?(0===this.activeFiles&&this.settings.onComplete.call(this.element),this.queuePos=this.queue.length-1,this.queueRunning=!1,!1):(this.queueRunning=!0,this.queue[this.queuePos].upload())},l.prototype.restartQueue=function(){this.queuePos=-1,this.queueRunning=!1,this.processQueue()},l.prototype.findById=function(e){var t,n;for(t=0,n=this.queue.length;t<n;t++)if(this.queue[t].id===e)return this.queue[t];return!1},l.prototype.cancelAll=function(){var e,t,n=this.queueRunning;for(this.queueRunning=!1,e=0,t=this.queue.length;e<t;e++)this.queue[e].cancel();n&&this.settings.onComplete.call(this.element)},l.prototype.startAll=function(){var e,t;if(this.settings.queue)this.restartQueue();else for(e=0,t=this.queue.length;e<t;e++)this.queue[e].upload()},l.prototype.methods={start:function(e){if(this.queueRunning)return!1;var n=!1;return void 0===e||(n=this.findById(e))?n?(n.status===o&&(n.status=t),n.upload()):(this.startAll(),!0):($.error("File not found in the dmUploader plugin"),!1)},cancel:function(e){var t=!1;return void 0===e||(t=this.findById(e))?t?t.cancel(!0):(this.cancelAll(),!0):($.error("File not found in the dmUploader plugin"),!1)},reset:function(){return this.cancelAll(),this.queue=[],this.queuePos=-1,this.activeFiles=0,!0},destroy:function(){this.cancelAll(),this.releaseEvents(),this.element.removeData(e)}},$.fn.dmUploader=function(t){var n=arguments;if("string"!=typeof t)return this.each(function(){$.data(this,e)||$.data(this,e,new l(this,t))});this.each(function(){var i=$.data(this,e);i instanceof l?"function"==typeof i.methods[t]?i.methods[t].apply(i,Array.prototype.slice.call(n,1)):$.error("Method "+t+" does not exist in the dmUploader plugin"):$.error("Unknown plugin data found by the dmUploader plugin")})},$.fn.dmUploader.defaults=$.extend({},{auto:!0,queue:!0,dnd:!0,hookDocument:!0,multiple:!0,url:document.URL,method:"POST",extraData:{},headers:{},dataType:null,fieldName:"file",maxFileSize:0,allowedTypes:"*",extFilter:null,inputFile:null,onInit:function(){},onBegin:function(){},onComplete:function(){},onFallbackMode:function(){},onNewFile:function(){},onBeforeUpload:function(){},onUploadProgress:function(){},onUploadSuccess:function(){},onUploadCanceled:function(){},onUploadError:function(){},onUploadComplete:function(){},onFileTypeError:function(){},onFileSizeError:function(){},onFileExtError:function(){},onDragEnter:function(){},onDragLeave:function(){},onDocumentDragEnter:function(){},onDocumentDragLeave:function(){}},$.fn.dmUploader.defaults||{})});