/*!
jQuery autoRefresh widget v.1.2
(C) 2014-2019 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
!function($,t,e,s){$.widget("cmsms.autoRefresh",{options:{url:null,data:null,interval:30,start_handler:null,done_handler:null},settings:{timer:null,focus:-1,lastrefresh:null},_create:function(){if(!this.options.url)throw"An URL must be specified for the autoRefresh widget";var t=this.options.interval;if(t<1||t>3600)throw"The autoRefresh widget refresh-interval must be in the range 1 to 3600";e.contains(this.element[0])&&this.element.find(":input,a").on("click",function(){s.start()});var s=this;$(e).on("focus",function(){s.settings.focus<1&&(s.settings.focus=1,Date.now()/1e3-s.settings.lastrefresh>=s.options.interval&&(s.start(),s.refresh()))}),$(e).on("blur",function(){1===s.settings.focus&&(s.settings.focus=0)}),this.start(),this.refresh()},_setOption:function(t,e){switch(t){case"url":"string"==typeof e&&e.length>0&&(this.options.url=e),this.start();break;case"data":return this.options.data=e,this.start(),this.refresh();case"interval":var s=parseInt(e);s>0&&(this.options.interval=Math.min(s,3600)),this.start();break;case"start_handler":this.options.start_handler="function"==typeof e?e:null;break;case"done_handler":this.options.done_handler="function"==typeof e?e:null}},stop:function(){this.settings.timer&&(clearInterval(this.settings.timer),this.settings.timer=null)},start:function(){var t=this;t.stop(),t.settings.timer=setInterval(function(){t.refresh()},1e3*t.options.interval)},reset:function(){this.start()},refresh:function(){var t=this;if(t.settings.focus){var s=Date.now()/1e3;return t.settings.lastrefresh=s,"function"==typeof t.options.start_handler&&t.options.start_handler(),cms_busy(),$.ajax(t.options.url,{data:t.options.data,cache:!1}).fail(function(t,e,s){console.debug("autorefresh failed: "+s)}).done(function(s){console.debug("autorefresh success"),e.contains(t.element[0])&&t.element.html(s),"function"==typeof t.options.done_handler&&t.options.done_handler(s)}).always(function(){cms_busy(!1)})}}})}(jQuery,window,document);
