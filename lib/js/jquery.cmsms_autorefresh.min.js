!function($){$.widget("cmsms.autoRefresh",{options:{url:null,data:null,interval:30,start_handler:null,done_handler:null},settings:{timer:null,focus:-1,lastrefresh:null},_create:function(){var t=this;if(!this.options.url)throw"A URL must be specified for the autoRefresh plugin";var s=this.options.interval;if(s<1||s>3600)throw"autoRefresh interval must be between 1 and 3600";$(this.element).on("click",":input",function(){t.start()}),$(this.element).on("click","a",function(){t.start()}),$(window).focus(function(){t.settings.focus<1&&(t.settings.focus=1,Date.now()/1e3-t.settings.lastrefresh>=t.options.interval&&(t.start(),t.refresh()))}),$(window).blur(function(){1===t.settings.focus&&(t.settings.focus=0)}),this.start(),this.refresh()},_setOption:function(t,s){switch(t){case"url":"string"==typeof s&&s.length>0&&(this.options.url=s),this.start();break;case"data":return this.options.data=s,this.start(),this.refresh();case"interval":var e=parseInt(s);e>0&&(this.options.url=Math.min(e,3600)),this.start();break;case"start_handler":this.options.start_handler="function"==typeof s?s:null;break;case"done_handler":this.options.done_handler="function"==typeof s?s:null}},stop:function(){this.settings.timer&&(clearInterval(this.settings.timer),this.settings.timer=null)},start:function(){var t=this;t.stop(),t.settings.timer=setInterval(function(){t.refresh()},1e3*t.options.interval)},reset:function(){this.start()},refresh:function(){var t=this;if(t.settings.focus){var s=Date.now()/1e3;return t.settings.lastrefresh=s,t.options.start_handler&&t.options.start_handler(),cms_busy(),$.ajax({url:t.options.url,data:t.options.data,cache:!1}).then(function(t){return cms_busy(!1),t}).fail(function(t,s,e){console.debug("autorefresh failed")}).done(function(s){console.debug("autorefresh success"),$(t.element).html(s),"function"==typeof t.options.done_handler&&t.options.done_handler(s)})}}})}(jQuery);