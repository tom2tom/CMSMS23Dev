(function(a){a.widget("cmsms.dirtyForm",{options:{unloadmsg:"Are you sure you want to leave this page?  some changes may be lost",disabled:false,dirty:false,formClass:"dirtyForm",beforeUnload:null,unloadCancel:null,onUnload:null,onDirty:function(c,b){}},_create:function(){var b=this;this.element.on("keyup","input:not([type=submit]), select, textarea",function(c){if(b.options.disabled==false&&b.options.dirty==false){b._setOption("dirty",true)}});this.element.on("change","input:not([type=submit]), select, textarea",function(){if(b.options.disabled==false&&b.options.dirty==false){b._setOption("dirty",true)}});a(document).on("cmsms_formchange",function(c){if(b.options.disabled==false&&b.options.dirty==false){b._setOption("dirty",true)}});a(window).on("beforeunload",function(){console.debug("dirtyform beforeunload");if(b.options.disabled){return}var c=null;var d="";if(b.options.beforeUnload){c=b.options.beforeUnload(b.options.dirty)}if(b.options.dirty){d=b.options.unloadmsg.trim()}if(c!=null&&c.length>0){d=c.trim()}if(d!=null&&d.length>0){if(b.options.unloadCancel){setTimeout(function(){console.debug("in outer timer");setTimeout(function(){console.debug("dirtyform unloadCancel");b.options.unloadCancel()},1000)},1)}return d}});a(window).on("unload",function(){if(b.options.disabled){return}console.debug("dirtyform unload");if(b.options.onUnload){b.options.onUnload(b.options.dirty)}})},_setOption:function(c,b){this.options[c]=b;if(c=="disabled"){this.options.disabled=b}if(c=="dirty"){if(!b){console.debug("dirtyform dirty = false");this.options.dirty=false;this.element.find("form").removeClass(this.options.formClass)}else{console.debug("dirtyform dirty = true");var d=this.element.find("form").addClass(this.options.formClass);this.options.dirty=true;this.options.onDirty(this,d)}}}})})(jQuery);