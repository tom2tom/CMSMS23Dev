!function($){$.widget("cmsms.dirtyForm",{options:{unloadmsg:"Are you sure you want to leave this page? Some changes may be lost.",disabled:!1,dirty:!1,formClass:"dirtyForm",beforeUnload:null,unloadCancel:null,onUnload:null,onDirty:function(o,t){}},_create:function(){var o=this;this.element.on("keyup","input:not([type=submit]), select, textarea",function(t){0==o.options.disabled&&0==o.options.dirty&&o._setOption("dirty",!0)}),this.element.on("change","input:not([type=submit]), select, textarea",function(){0==o.options.disabled&&0==o.options.dirty&&o._setOption("dirty",!0)}),$(document).on("cmsms_formchange",function(t){0==o.options.disabled&&0==o.options.dirty&&o._setOption("dirty",!0)}),$(window).on("beforeunload",function(){if(console.debug("dirtyform beforeunload"),!o.options.disabled){var t=null,n="";return o.options.beforeUnload&&(t=o.options.beforeUnload(o.options.dirty)),o.options.dirty&&(n=o.options.unloadmsg.trim()),null!=t&&t.length>0&&(n=t.trim()),null!=n&&n.length>0?(o.options.unloadCancel&&setTimeout(function(){console.debug("in outer timer"),setTimeout(function(){console.debug("dirtyform unloadCancel"),o.options.unloadCancel()},1e3)},1),n):void 0}}),$(window).on("unload",function(){o.options.disabled||(console.debug("dirtyform unload"),o.options.onUnload&&o.options.onUnload(o.options.dirty))})},_setOption:function(o,t){if(this.options[o]=t,"disabled"==o&&(this.options.disabled=t),"dirty"==o)if(t){console.debug("dirtyform dirty = true");var n=this.element.find("form").addClass(this.options.formClass);this.options.dirty=!0,this.options.onDirty(this,n)}else console.debug("dirtyform dirty = false"),this.options.dirty=!1,this.element.find("form").removeClass(this.options.formClass)}})}(jQuery);