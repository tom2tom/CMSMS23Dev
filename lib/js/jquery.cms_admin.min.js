/*!
CMSMS admin functions
(C) 2014-2018 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
(function(c,$){"use strict";var a,h=function(){},e=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=e.length,f=(window.console=window.console||{});while(d--){a=e[d];if(!f[a]){f[a]=h}}var b=c.CMSMS_Admin||{};$(document).ready(function(){b.Loader.init()});b.namespace=function(m){var n=m.split("."),l=b,j,k;if(n[0]==="CMSMS_Admin"){n=n.slice(1)}for(j=0;j<n.length;j+=1){k=n[j];if(typeof l[k]==="undefined"){l[k]={}}l=l[k]}return l};var g=b.namespace("CMSMS_Admin.Loader");g.init=function(){b.Helper.cms_resizableTextArea();b.Helper.cms_helpDialog();b.Helper.cms_initTabs();b.Helper.cms_initModalDialog();b.Helper.cms_initTooltips();b.Helper.cms_uploadLimit()};var i=b.namespace("CMSMS_Admin.Helper");i.cms_uploadLimit=function(){$("form").on("submit",function(l){if($(this).attr("novalidate")){return}var j=$("input[type=file]",this);if(j.length===0){return}var k=0;j.each(function(m,n){if(n.files.length===0){return}k+=n.files[0].size});if(typeof cms_data!=="undefined"&&typeof cms_data.max_upload_size!=="undefined"&&cms_data.max_upload_size>0&&k>cms_data.max_upload_size){cms_alert(cms_lang("largeupload"));return false}})};i.cms_resizableTextArea=function(){var j=document.createElement("textarea");$("textarea").each(function(){var k=$(this);if((j.style.resize===undefined||k.hasClass("cms_resizable"))&&(!k.hasClass("MicroTiny"))&&(!k.hasClass("no-resize"))){k.resizable({handles:"se",ghost:true})}})};i.cms_helpDialog=function(){$(".cms_help .cms_helpicon").on("click",function(){activateHelp(this)})};i.cms_initTabs=function(){function k(m){var l=$("#navt_tabs");if(l.length===0){l=$("#page_tabs")}l.find("div:eq("+m+")").trigger("mousedown")}var j=$("#navt_tabs, #page_tabs").find("div");j.on("mousedown",function(){var l=$(this);j.each(function(){var m=$(this);m.removeClass("active");$("#"+m.attr("id")+"_c").hide()});l.addClass("active");$("#"+l.attr("id")+"_c").show();return true});j.on("focus",function(l){$(this).addClass("focus")});j.on("blur",function(l){$(this).removeClass("focus")});j.on("keyup",function(l){if(l.keyCode==$.ui.keyCode.ENTER){var m=j.index(this);k(m)}});j.attr("tabindex","0");if(j.filter(".active").mousedown().length===0){k(0)}};i.cms_initModalDialog=function(){var j={};$(".dialog").each(function(){var l=$(this),k=$(this).prev(".open").attr("title");j[k]=l.dialog({autoOpen:false,modal:true})});$(".open").on("click",function(m){m.preventDefault();var l=$(this),k=l.attr("title");j[k].dialog("open").removeClass("invisible");return false})};i.cms_initTooltips=function(){$(".tooltip").tooltip({items:"[title], [data-cms-description], [data-cms-ajax]",content:function(n){var k=$(this),m=k.data(),l,j;if(k.is("[data-cms-description]")){l=m.cmsDescription;return l}if(k.is("[data-cms-ajax]")){j=m.cmsAjax;j+="&cmsjobtype=1";$.ajax({url:j,async:true,dataType:"html",error:function(o,q,p){f.log("Sorry. There was a error in your request: "+q+" "+p)},success:function(o){n(o)}})}if(k.is("[title]")){return k.attr("title")}}})};i.cms_jquiMarkup=function(){$("[data-jqui]").each(function(k,l){var j=$(l).data();$.each(j.jqui.split(/\s+/),function(m,n){$(l)[n](j)})})}}(this,jQuery));(function($){"use strict";var b="cmsms_checkall",c={target:"table"};function a(e,d){this.element=e;this.settings=$.extend({},c,d);this.defaults=c;this._name=b;this.init()}a.prototype={init:function(){this._toggle(this.element,this.settings.target)},_toggle:function(g,d){var f=$(g).closest(d),e=$(g);$("[type=checkbox]",f).not(e).on("click",function(){var i=$(this),h=i.prop("checked",!i.prop("checked"));e.prop("checked",false);i.prop("checked",!i.prop("checked"));i.trigger("cms_checkall_toggle",{checked:h})});e.on("click",function(){var h=e.is(":checked");$("[type=checkbox]",f).each(function(){var i=$(this);i.attr("checked",h);i.trigger("cms_checkall_toggle",{checked:h})})})}};$.fn[b]=function(d){return this.each(function(){if(!$.data(this,"plugin_"+b)){$.data(this,"plugin_"+b,new a(this,d))}})}}(jQuery));(function($){"use strict";$.widget("cmsms.cmsms_sortable_table",$.extend({},$.ui.sortable.prototype,{options:{actionurl:null,update:null,helper:null,callback:function(a){}},_create:function(){var a=this;this.element.data("sortable",this.element.data("cmsms_sortable_table"));this.options.update=function(b,c){a._update(a.options,a.element)};this.options.helper=this._uiFixHelper;return $.ui.sortable.prototype._create.apply(this,arguments)},_update:function(b,c){var a=b.actionurl,d=this.serialize($(c));$(c).find("tr:even").attr("class","row1");$(c).find("tr:odd").attr("class","row2");$.post(a+"&"+d,function(e){b.callback(e)})},serialize:function(c){var a=this._getItemsAsjQuery(c&&c.connected),b=[];c=c||{};$(a).each(function(){var d=($(c.item||this).attr(c.attribute||"id")||"").match(c.expression||(/(.+)[\-=_](.+)/));if(d){b.push((c.key||d[1]+"[]")+"="+(c.key&&c.expression?d[1]:d[2]))}});if(!b.length&&c.key){b.push(c.key+"=")}return b.join("&")},_uiFixHelper:function(b,a){a.children().each(function(){$(this).width($(this).width())});return a}}));$.cmsms.cmsms_sortable_table.prototype.options=$.extend({},$.ui.sortable.prototype.options,$.cmsms.cmsms_sortable_table.prototype.options)}(jQuery));if(typeof cms_data==="undefined"){var cms_data={}}cms_data=$.extend(cms_data,{alertfunc:null,dialogfunc:null,confirmfunc:null,notifyfunc:null,promptfunc:null,infonotices:null,successnotices:null,warnnotices:null,errornotices:null});function cms_lang(a){a="lang_"+a;if(typeof cms_data[a]!=="undefined"){return cms_data[a]}cms_alert("lang key "+a+" not set")}if(!String.prototype.startsWith){String.prototype.startsWith=function(b,a){a=a||0;return this.substr(a,b.length)===b}}function togglecollapse(a){$("#"+a).toggle()}function activateHelp(c){var b=$(c).parent().data(),a=b.cmshelpKey;$.get(cms_data.ajax_help_url,{key:a},function(d){cms_help(c,b,d)})}function cms_help(c,d,j){var g=$(c).offset(),f=g.top-$(window).scrollTop(),b=g.left-$(window).scrollLeft();d.lasty=f;d.lastx=b;var e=d.cmshelpTitle,a=e.indexOf("(");if(a!==-1){e=e.substring(0,a-1)}var i=cms_lang("title_help")+": "+e;$.toast({text:j,heading:i,showHideTransition:"fade",hideAfter:0,loader:false,position:{top:f,left:b},myclass:"info",closeicon:"",beforeShow:function(h){var k=$(h).find(".jqt-heading");if(k.length>0){k[0].onmousedown=l}else{h.onmousedown=l}function l(m){m=m||window.event;d.offy=m.clientY-d.lasty;d.offx=m.clientX-d.lastx;document.onmouseup=function(){document.onmouseup=null;document.onmousemove=null};document.onmousemove=function(n){n=n||window.event;var o=n.clientY-d.offy,p=n.clientX-d.offx;if(Math.abs(o-d.lasty)>2||Math.abs(p-d.lastx)>2){$(h).css({top:o,left:p});d.lasty=o;d.lastx=p}}}}})}function cms_dialog(b,a){if(typeof a==="undefined"){a={}}if(typeof a==="object"&&a!==null&&typeof a.closeText==="undefined"){a.closeText=cms_lang("close")}if(typeof cms_data.dialogfunc!=="function"){b.dialog(a)}else{cms_data.dialogfunc(b,a)}}function cms_prompt(f,e,d){if(typeof f==="undefined"||f==""){return}if(typeof e==="undefined"){e=""}if(typeof d==="undefined"){d=""}if(typeof cms_data.promptfunc!=="function"){if($("#cmsms_promptDialog").length===0){$('<div id="cmsms_promptDialog" style="display:none;"></div>').insertAfter("body")}var b='<h4 class="prompt">'+f+'</h4><input type="text" class="prompt" value="'+e+'" />';var g=cms_lang("ok"),c=cms_lang("cancel"),a=$.Deferred();$("#cmsms_promptDialog").html(b).dialog({modal:true,title:d,width:"auto",buttons:[{text:g,icons:{primary:"ui-icon-check"},click:function(h){b=$("#cmsms_promptDialog input").val();$(this).dialog("close");if(b){a.resolve(b)}else{a.reject(null)}}},{text:c,icons:{primary:"ui-icon-close"},click:function(h){$(this).dialog("close");a.reject(null)}}]});return a.promise()}return cms_data.promptfunc(f,e,d)}function cms_alert(d,c){if(typeof d==="undefined"||d==""){return}if(typeof c==="undefined"||c===""){c=cms_lang("alert")}if(typeof cms_data.alertfunc!=="function"){if($("#cmsms_errorDialog").length===0){$('<div id="cmsms_errorDialog" style="display:none;"></div>').insertAfter("body")}var a=$.Deferred(),b=cms_lang("close");$("#cmsms_errorDialog").html(d).dialog({modal:true,title:c,buttons:[{text:b,icons:{primary:"ui-icon-close"},click:function(e){$(this).dialog("close");a.resolve()}}],close:function(e,f){a.resolve()}});return a.promise()}return cms_data.alertfunc(d,c)}function cms_confirm(d,c,e,b){if(typeof d==="undefined"||d==""){return}if(typeof c==="undefined"||c==""){c=cms_lang("confirm")}if(typeof e==="undefined"||e==""){e=cms_lang("ok")}if(typeof b==="undefined"||b==""){b=cms_lang("cancel")}if(typeof cms_data.confirmfunc!=="function"){if($("#cmsms_confirmDialog").length===0){$('<div id="cmsms_confirmDialog" style="display:none;"></div>').insertAfter("body")}var a=$.Deferred();$("#cmsms_confirmDialog").html(d).dialog({modal:true,title:c,buttons:[{text:e,icons:{primary:"ui-icon-check"},click:function(f){$(this).dialog("close");a.resolve(e)}},{text:b,icons:{primary:"ui-icon-close"},click:function(f){$(this).dialog("close");a.reject(b)}}]});return a.promise()}return cms_data.confirmfunc(d,c,e,b)}function cms_confirm_btnclick(a,d,c,e,b){cms_confirm(d,c,e,b).done(function(){$(a).unbind("click").click()})}function cms_confirm_linkclick(a,d,c,e,b){cms_confirm(d,c,e,b).done(function(){window.location=$(a).attr("href")})}function cms_notify(b,e,d,c){if(typeof d==="undefined"){d=""}if(typeof c==="undefined"){c={}}if(typeof cms_data.notifyfunc!=="function"){var a=$.extend({text:e,heading:d,showHideTransition:"fade",hideAfter:0,loader:false,position:"top-center",myclass:b,icon:true,closeicon:""},c);return $.toast(a)}return cms_data.notifyfunc(b,e,d,c)}function cms_notify_all(){if(typeof cms_data.infonotices!=="undefined"&&cms_data.infonotices){cms_notify("info",cms_data.infonotices)}if(typeof cms_data.successnotices!=="undefined"&&cms_data.successnotices){cms_notify("success",cms_data.successnotices)}if(typeof cms_data.warnnotices!=="undefined"&&cms_data.warnnotices){cms_notify("warn",cms_data.warnnotices)}if(typeof cms_data.errornotices!=="undefined"&&cms_data.errornotices){cms_notify("error",cms_data.errornotices)}}function cms_busy(b){if(typeof b==="undefined"){b=true}var c=$("#cms_busy");if(!c.length){var a=$("<div/>").attr("id","cms_busy").addClass("busy").hide();$("body").append(a)}if(b){setTimeout(function(){c.show()},10)}else{if(c.length){c.hide()}}}function cms_equalHeight(c){var a=0,b;c.each(function(){b=$(this).height();if(b>a){a=b}});c.height(a)}function cms_equalWidth(c){var a=0,b;c.each(function(){b=$(this).width();if(b>a){a=b}});c.width(a)};